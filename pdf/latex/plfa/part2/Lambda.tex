\hypertarget{Lambda}{%
\chapter{Lambda: Introduction to Lambda Calculus}\label{Lambda}}

\begin{fence}
\begin{code}%
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{plfa.part2.Lambda}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\end{code}
\end{fence}

The \emph{lambda-calculus}, first published by the logician Alonzo
Church in 1932, is a core calculus with only three syntactic constructs:
variables, abstraction, and application. It captures the key concept of
\emph{functional abstraction}, which appears in pretty much every
programming language, in the form of either functions, procedures, or
methods. The \emph{simply-typed lambda calculus} (or STLC) is a variant
of the lambda calculus published by Church in 1940. It has the three
constructs above for function types, plus whatever else is required for
base types. Church had a minimal base type with no operations. We will
instead echo Plotkin's \emph{Programmable Computable Functions} (PCF),
and add operations on natural numbers and recursive function
definitions.

This chapter formalises the simply-typed lambda calculus, giving its
syntax, small-step semantics, and typing rules. The next chapter
\protect\hyperlink{Properties}{Properties} proves its main properties,
including progress and preservation. Following chapters will look at a
number of variants of lambda calculus.

Be aware that the approach we take here is \emph{not} our recommended
approach to formalisation. Using de Bruijn indices and
intrinsically-typed terms, as we will do in Chapter
\protect\hyperlink{DeBruijn}{DeBruijn}, leads to a more compact
formulation. Nonetheless, we begin with named variables and
extrinsically-typed terms, partly because names are easier than indices
to read, and partly because the development is more traditional.

The development in this chapter was inspired by the corresponding
development in Chapter \emph{Stlc} of \emph{Software Foundations}
(\emph{Programming Language Foundations}). We differ by representing
contexts explicitly (as lists pairing identifiers with types) rather
than as partial maps (which take identifiers to types), which
corresponds better to our subsequent development of DeBruijn notation.
We also differ by taking natural numbers as the base type rather than
booleans, allowing more sophisticated examples. In particular, we will
be able to show (twice!) that two plus two is four.

\hypertarget{imports}{%
\section{Imports}\label{imports}}

\begin{fence}
\begin{code}%
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Data.Bool}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{T}\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{not}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Data.Empty}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaDatatype{⊥}\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{⊥-elim}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Data.List}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaDatatype{List}\AgdaSymbol{;}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{\AgdaUnderscore{}∷\AgdaUnderscore{}}}\AgdaSymbol{;}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Data.Nat}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaDatatype{ℕ}\AgdaSymbol{;}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSymbol{;}\AgdaSpace{}%
\AgdaInductiveConstructor{suc}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Data.Product}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{∃-syntax}\AgdaSymbol{;}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}×\AgdaUnderscore{}}}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Data.String}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaPostulate{String}\AgdaSymbol{;}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}≟\AgdaUnderscore{}}}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Relation.Nullary}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaRecord{Dec}\AgdaSymbol{;}\AgdaSpace{}%
\AgdaInductiveConstructor{yes}\AgdaSymbol{;}\AgdaSpace{}%
\AgdaInductiveConstructor{no}\AgdaSymbol{;}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{¬\AgdaUnderscore{}}}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Relation.Nullary.Decidable}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaFunction{⌊\AgdaUnderscore{}⌋}}\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{False}\AgdaSymbol{;}\AgdaSpace{}%
\AgdaFunction{toWitnessFalse}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Relation.Nullary.Negation}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{¬?}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Relation.Binary.PropositionalEquality}\AgdaSpace{}%
\AgdaKeyword{using}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaDatatype{\AgdaUnderscore{}≡\AgdaUnderscore{}}}\AgdaSymbol{;}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}≢\AgdaUnderscore{}}}\AgdaSymbol{;}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSymbol{)}\<%
\end{code}
\end{fence}

\hypertarget{syntax-of-terms}{%
\section{Syntax of terms}\label{syntax-of-terms}}

Terms have seven constructs. Three are for the core lambda calculus:

\begin{itemize}
\tightlist
\item
  Variables \texttt{\textasciigrave{}\ x}
\item
  Abstractions \texttt{ƛ\ x\ ⇒\ N}
\item
  Applications \texttt{L\ ·\ M}
\end{itemize}

Three are for the naturals:

\begin{itemize}
\tightlist
\item
  Zero \texttt{\textasciigrave{}zero}
\item
  Successor \texttt{\textasciigrave{}suc\ M}
\item
  Case \texttt{case\ L\ {[}zero⇒\ M\ \textbar{}suc\ x\ ⇒\ N\ {]}}
\end{itemize}

And one is for recursion:

\begin{itemize}
\tightlist
\item
  Fixpoint \texttt{μ\ x\ ⇒\ M}
\end{itemize}

Abstraction is also called \emph{lambda abstraction}, and is the
construct from which the calculus takes its name.

With the exception of variables and fixpoints, each term form either
constructs a value of a given type (abstractions yield functions, zero
and successor yield natural numbers) or deconstructs it (applications
use functions, case terms use naturals). We will see this again when we
come to the rules for assigning types to terms, where constructors
correspond to introduction rules and deconstructors to eliminators.

Here is the syntax of terms in Backus-Naur Form (BNF):

\begin{myDisplay}
L, M, N  ::=
  ` x  |  ƛ x ⇒ N  |  L · M  |
  `zero  |  `suc M  |  case L [zero⇒ M |suc x ⇒ N ]  |
  μ x ⇒ M
\end{myDisplay}

And here it is formalised in Agda:

\begin{fence}
\begin{code}%
\>[0]\AgdaFunction{Id}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitiveType{Set}\<%
\\
\>[0]\AgdaFunction{Id}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaPostulate{String}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaKeyword{infix}%
\>[7]\AgdaNumber{5}%
\>[10]\AgdaOperator{\AgdaInductiveConstructor{ƛ\AgdaUnderscore{}⇒\AgdaUnderscore{}}}\<%
\\
\>[0]\AgdaKeyword{infix}%
\>[7]\AgdaNumber{5}%
\>[10]\AgdaOperator{\AgdaInductiveConstructor{μ\AgdaUnderscore{}⇒\AgdaUnderscore{}}}\<%
\\
\>[0]\AgdaKeyword{infixl}\AgdaSpace{}%
\AgdaNumber{7}%
\>[10]\AgdaOperator{\AgdaInductiveConstructor{\AgdaUnderscore{}·\AgdaUnderscore{}}}\<%
\\
\>[0]\AgdaKeyword{infix}%
\>[7]\AgdaNumber{8}%
\>[10]\AgdaOperator{\AgdaInductiveConstructor{`suc\AgdaUnderscore{}}}\<%
\\
\>[0]\AgdaKeyword{infix}%
\>[7]\AgdaNumber{9}%
\>[10]\AgdaOperator{\AgdaInductiveConstructor{`\AgdaUnderscore{}}}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaKeyword{data}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitiveType{Set}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaOperator{\AgdaInductiveConstructor{`\AgdaUnderscore{}}}%
\>[26]\AgdaSymbol{:}%
\>[29]\AgdaFunction{Id}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Term}\<%
\\
%
\>[2]\AgdaOperator{\AgdaInductiveConstructor{ƛ\AgdaUnderscore{}⇒\AgdaUnderscore{}}}%
\>[26]\AgdaSymbol{:}%
\>[29]\AgdaFunction{Id}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Term}\<%
\\
%
\>[2]\AgdaOperator{\AgdaInductiveConstructor{\AgdaUnderscore{}·\AgdaUnderscore{}}}%
\>[26]\AgdaSymbol{:}%
\>[29]\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Term}\<%
\\
%
\>[2]\AgdaInductiveConstructor{`zero}%
\>[26]\AgdaSymbol{:}%
\>[29]\AgdaDatatype{Term}\<%
\\
%
\>[2]\AgdaOperator{\AgdaInductiveConstructor{`suc\AgdaUnderscore{}}}%
\>[26]\AgdaSymbol{:}%
\>[29]\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Term}\<%
\\
%
\>[2]\AgdaOperator{\AgdaInductiveConstructor{case\AgdaUnderscore{}[zero⇒\AgdaUnderscore{}|suc\AgdaUnderscore{}⇒\AgdaUnderscore{}]}}%
\>[26]\AgdaSymbol{:}%
\>[29]\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{Id}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Term}\<%
\\
%
\>[2]\AgdaOperator{\AgdaInductiveConstructor{μ\AgdaUnderscore{}⇒\AgdaUnderscore{}}}%
\>[26]\AgdaSymbol{:}%
\>[29]\AgdaFunction{Id}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Term}\<%
\end{code}
\end{fence}

We represent identifiers by strings. We choose precedence so that lambda
abstraction and fixpoint bind least tightly, then application, then
successor, and tightest of all is the constructor for variables. Case
expressions are self-bracketing.

\hypertarget{example-terms}{%
\subsection{Example terms}\label{example-terms}}

Here are some example terms: the natural number two, a function that
adds naturals, and a term that computes two plus two:

\begin{fence}
\begin{code}%
\>[0]\AgdaFunction{two}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Term}\<%
\\
\>[0]\AgdaFunction{two}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`suc}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`suc}}\AgdaSpace{}%
\AgdaInductiveConstructor{`zero}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{plus}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Term}\<%
\\
\>[0]\AgdaFunction{plus}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{μ}}%
\>[100I]\AgdaString{"+"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{ƛ}}\AgdaSpace{}%
\AgdaString{"m"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{ƛ}}\AgdaSpace{}%
\AgdaString{"n"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\<%
\\
\>[.][@{}l@{}]\<[100I]%
\>[9]\AgdaOperator{\AgdaInductiveConstructor{case}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaString{"m"}\<%
\\
\>[9][@{}l@{\AgdaIndent{0}}]%
\>[11]\AgdaOperator{\AgdaInductiveConstructor{[zero⇒}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaString{"n"}\<%
\\
%
\>[11]\AgdaOperator{\AgdaInductiveConstructor{|suc}}\AgdaSpace{}%
\AgdaString{"m"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`suc}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaString{"+"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaString{"m"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaString{"n"}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{]}}\<%
\end{code}
\end{fence}

The recursive definition of addition is similar to our original
definition of \texttt{\_+\_} for naturals, as given in Chapter
\protect\hyperlink{Naturals-plus}{Naturals}. Here variable ``m'' is
bound twice, once in a lambda abstraction and once in the successor
branch of the case; the first use of ``m'' refers to the former and the
second to the latter. Any use of ``m'' in the successor branch must
refer to the latter binding, and so we say that the latter binding
\emph{shadows} the former. Later we will confirm that two plus two is
four, in other words that the term

\begin{myDisplay}
plus · two · two
\end{myDisplay}

reduces to
\texttt{\textasciigrave{}suc\ \textasciigrave{}suc\ \textasciigrave{}suc\ \textasciigrave{}suc\ \textasciigrave{}zero}.

As a second example, we use higher-order functions to represent natural
numbers. In particular, the number \emph{n} is represented by a function
that accepts two arguments and applies the first \emph{n} times to the
second. This is called the \emph{Church representation} of the naturals.
Here are some example terms: the Church numeral two, a function that
adds Church numerals, a function to compute successor, and a term that
computes two plus two:

\begin{fence}
\begin{code}%
\>[0]\AgdaFunction{twoᶜ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Term}\<%
\\
\>[0]\AgdaFunction{twoᶜ}\AgdaSpace{}%
\AgdaSymbol{=}%
\>[8]\AgdaOperator{\AgdaInductiveConstructor{ƛ}}\AgdaSpace{}%
\AgdaString{"s"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{ƛ}}\AgdaSpace{}%
\AgdaString{"z"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaString{"s"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaString{"s"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaString{"z"}\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{plusᶜ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Term}\<%
\\
\>[0]\AgdaFunction{plusᶜ}\AgdaSpace{}%
\AgdaSymbol{=}%
\>[9]\AgdaOperator{\AgdaInductiveConstructor{ƛ}}\AgdaSpace{}%
\AgdaString{"m"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{ƛ}}\AgdaSpace{}%
\AgdaString{"n"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{ƛ}}\AgdaSpace{}%
\AgdaString{"s"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{ƛ}}\AgdaSpace{}%
\AgdaString{"z"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\<%
\\
%
\>[9]\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaString{"m"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaString{"s"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaString{"n"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaString{"s"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaString{"z"}\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{sucᶜ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Term}\<%
\\
\>[0]\AgdaFunction{sucᶜ}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{ƛ}}\AgdaSpace{}%
\AgdaString{"n"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`suc}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaString{"n"}\AgdaSymbol{)}\<%
\end{code}
\end{fence}

The Church numeral for two takes two arguments \texttt{s} and \texttt{z}
and applies \texttt{s} twice to \texttt{z}. Addition takes two numerals
\texttt{m} and \texttt{n}, a function \texttt{s} and an argument
\texttt{z}, and it uses \texttt{m} to apply \texttt{s} to the result of
using \texttt{n} to apply \texttt{s} to \texttt{z}; hence \texttt{s} is
applied \texttt{m} plus \texttt{n} times to \texttt{z}, yielding the
Church numeral for the sum of \texttt{m} and \texttt{n}. For
convenience, we define a function that computes successor. To convert a
Church numeral to the corresponding natural, we apply it to the
\texttt{sucᶜ} function and the natural number zero. Again, later we will
confirm that two plus two is four, in other words that the term

\begin{myDisplay}
plusᶜ · twoᶜ · twoᶜ · sucᶜ · `zero
\end{myDisplay}

reduces to
\texttt{\textasciigrave{}suc\ \textasciigrave{}suc\ \textasciigrave{}suc\ \textasciigrave{}suc\ \textasciigrave{}zero}.

\hypertarget{exercise-mul-recommended}{%
\subsubsection{\texorpdfstring{Exercise \texttt{mul}
(recommended)}{Exercise mul (recommended)}}\label{exercise-mul-recommended}}

Write out the definition of a lambda term that multiplies two natural
numbers. Your definition may use \texttt{plus} as defined earlier.

\begin{fence}
\begin{code}%
\>[0]\AgdaComment{-- Your code goes here}\<%
\end{code}
\end{fence}

\hypertarget{exercise-mulux1d9c-practice}{%
\subsubsection{\texorpdfstring{Exercise \texttt{mulᶜ}
(practice)}{Exercise mulᶜ (practice)}}\label{exercise-mulux1d9c-practice}}

Write out the definition of a lambda term that multiplies two natural
numbers represented as Church numerals. Your definition may use
\texttt{plusᶜ} as defined earlier (or may not --- there are nice
definitions both ways).

\begin{fence}
\begin{code}%
\>[0]\AgdaComment{-- Your code goes here}\<%
\end{code}
\end{fence}

\hypertarget{Lambda-primed}{%
\subsubsection{\texorpdfstring{Exercise \texttt{primed}
(stretch)}{Exercise primed (stretch)}}\label{Lambda-primed}}

Some people find it annoying to write \texttt{\textasciigrave{}\ "x"}
instead of \texttt{x}. We can make examples with lambda terms slightly
easier to write by adding the following definitions:

\begin{fence}
\begin{code}%
\>[0]\AgdaOperator{\AgdaFunction{ƛ′\AgdaUnderscore{}⇒\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Term}\<%
\\
\>[0]\AgdaOperator{\AgdaFunction{ƛ′}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⇒}}\AgdaSpace{}%
\AgdaBound{N}%
\>[14]\AgdaSymbol{=}%
\>[17]\AgdaOperator{\AgdaInductiveConstructor{ƛ}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaBound{N}\<%
\\
\>[0]\AgdaCatchallClause{\AgdaOperator{\AgdaFunction{ƛ′}}}\AgdaSpace{}%
\AgdaCatchallClause{\AgdaSymbol{\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaCatchallClause{\AgdaOperator{\AgdaFunction{⇒}}}\AgdaSpace{}%
\AgdaCatchallClause{\AgdaSymbol{\AgdaUnderscore{}}}%
\>[14]\AgdaSymbol{=}%
\>[17]\AgdaFunction{⊥-elim}\AgdaSpace{}%
\AgdaPostulate{impossible}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{where}\AgdaSpace{}%
\AgdaKeyword{postulate}\AgdaSpace{}%
\AgdaPostulate{impossible}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{⊥}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaOperator{\AgdaFunction{case′\AgdaUnderscore{}[zero⇒\AgdaUnderscore{}|suc\AgdaUnderscore{}⇒\AgdaUnderscore{}]}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Term}\<%
\\
\>[0]\AgdaOperator{\AgdaFunction{case′}}\AgdaSpace{}%
\AgdaBound{L}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{[zero⇒}}\AgdaSpace{}%
\AgdaBound{M}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{|suc}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⇒}}\AgdaSpace{}%
\AgdaBound{N}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}%
\>[35]\AgdaSymbol{=}%
\>[38]\AgdaOperator{\AgdaInductiveConstructor{case}}\AgdaSpace{}%
\AgdaBound{L}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{[zero⇒}}\AgdaSpace{}%
\AgdaBound{M}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{|suc}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaBound{N}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{]}}\<%
\\
\>[0]\AgdaCatchallClause{\AgdaOperator{\AgdaFunction{case′}}}\AgdaSpace{}%
\AgdaCatchallClause{\AgdaSymbol{\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaCatchallClause{\AgdaOperator{\AgdaFunction{[zero⇒}}}\AgdaSpace{}%
\AgdaCatchallClause{\AgdaSymbol{\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaCatchallClause{\AgdaOperator{\AgdaFunction{|suc}}}\AgdaSpace{}%
\AgdaCatchallClause{\AgdaSymbol{\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaCatchallClause{\AgdaOperator{\AgdaFunction{⇒}}}\AgdaSpace{}%
\AgdaCatchallClause{\AgdaSymbol{\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaCatchallClause{\AgdaOperator{\AgdaFunction{]}}}%
\>[35]\AgdaSymbol{=}%
\>[38]\AgdaFunction{⊥-elim}\AgdaSpace{}%
\AgdaPostulate{impossible}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{where}\AgdaSpace{}%
\AgdaKeyword{postulate}\AgdaSpace{}%
\AgdaPostulate{impossible}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{⊥}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaOperator{\AgdaFunction{μ′\AgdaUnderscore{}⇒\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Term}\<%
\\
\>[0]\AgdaOperator{\AgdaFunction{μ′}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⇒}}\AgdaSpace{}%
\AgdaBound{N}%
\>[14]\AgdaSymbol{=}%
\>[17]\AgdaOperator{\AgdaInductiveConstructor{μ}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaBound{N}\<%
\\
\>[0]\AgdaCatchallClause{\AgdaOperator{\AgdaFunction{μ′}}}\AgdaSpace{}%
\AgdaCatchallClause{\AgdaSymbol{\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaCatchallClause{\AgdaOperator{\AgdaFunction{⇒}}}\AgdaSpace{}%
\AgdaCatchallClause{\AgdaSymbol{\AgdaUnderscore{}}}%
\>[14]\AgdaSymbol{=}%
\>[17]\AgdaFunction{⊥-elim}\AgdaSpace{}%
\AgdaPostulate{impossible}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{where}\AgdaSpace{}%
\AgdaKeyword{postulate}\AgdaSpace{}%
\AgdaPostulate{impossible}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{⊥}\<%
\end{code}
\end{fence}

We intend to apply the function only when the first term is a variable,
which we indicate by postulating a term \texttt{impossible} of the empty
type \texttt{⊥}. If we use C-c C-n to normalise the term

\begin{myDisplay}
ƛ′ two ⇒ two
\end{myDisplay}

Agda will return an answer warning us that the impossible has occurred:

\begin{myDisplay}
⊥-elim (plfa.part2.Lambda.impossible (`` `suc (`suc `zero)) (`suc (`suc `zero)) ``)
\end{myDisplay}

While postulating the impossible is a useful technique, it must be used
with care, since such postulation could allow us to provide evidence of
\emph{any} proposition whatsoever, regardless of its truth.

The definition of \texttt{plus} can now be written as follows:

\begin{fence}
\begin{code}%
\>[0]\AgdaFunction{plus′}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Term}\<%
\\
\>[0]\AgdaFunction{plus′}\AgdaSpace{}%
\AgdaSymbol{=}%
\>[261I]\AgdaOperator{\AgdaFunction{μ′}}\AgdaSpace{}%
\AgdaFunction{+}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⇒}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ƛ′}}\AgdaSpace{}%
\AgdaFunction{m}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⇒}}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{ƛ′}}\AgdaSpace{}%
\AgdaFunction{n}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⇒}}\<%
\\
\>[261I][@{}l@{\AgdaIndent{0}}]%
\>[10]\AgdaOperator{\AgdaFunction{case′}}\AgdaSpace{}%
\AgdaFunction{m}\<%
\\
\>[10][@{}l@{\AgdaIndent{0}}]%
\>[12]\AgdaOperator{\AgdaFunction{[zero⇒}}\AgdaSpace{}%
\AgdaFunction{n}\<%
\\
%
\>[12]\AgdaOperator{\AgdaFunction{|suc}}\AgdaSpace{}%
\AgdaFunction{m}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{⇒}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`suc}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{+}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaFunction{m}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaFunction{n}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{where}\<%
\\
%
\>[2]\AgdaFunction{+}%
\>[5]\AgdaSymbol{=}%
\>[8]\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaString{"+"}\<%
\\
%
\>[2]\AgdaFunction{m}%
\>[5]\AgdaSymbol{=}%
\>[8]\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaString{"m"}\<%
\\
%
\>[2]\AgdaFunction{n}%
\>[5]\AgdaSymbol{=}%
\>[8]\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaString{"n"}\<%
\end{code}
\end{fence}

Write out the definition of multiplication in the same style.

\hypertarget{formal-vs-informal}{%
\subsection{Formal vs informal}\label{formal-vs-informal}}

In informal presentation of formal semantics, one uses choice of
variable name to disambiguate and writes \texttt{x} rather than
\texttt{\textasciigrave{}\ x} for a term that is a variable. Agda
requires we distinguish.

Similarly, informal presentation often use the same notation for
function types, lambda abstraction, and function application in both the
\emph{object language} (the language one is describing) and the
\emph{meta-language} (the language in which the description is written),
trusting readers can use context to distinguish the two. Agda is not
quite so forgiving, so here we use \texttt{ƛ\ x\ ⇒\ N} and
\texttt{L\ ·\ M} for the object language, as compared to
\texttt{λ\ x\ →\ N} and \texttt{L\ M} in our meta-language, Agda.

\hypertarget{bound-and-free-variables}{%
\subsection{Bound and free variables}\label{bound-and-free-variables}}

In an abstraction \texttt{ƛ\ x\ ⇒\ N} we call \texttt{x} the
\emph{bound} variable and \texttt{N} the \emph{body} of the abstraction.
A central feature of lambda calculus is that consistent renaming of
bound variables leaves the meaning of a term unchanged. Thus the five
terms

\begin{itemize}
\tightlist
\item
  \texttt{ƛ\ "s"\ ⇒\ ƛ\ "z"\ ⇒\ \textasciigrave{}\ "s"\ ·\ (\textasciigrave{}\ "s"\ ·\ \textasciigrave{}\ "z")}
\item
  \texttt{ƛ\ "f"\ ⇒\ ƛ\ "x"\ ⇒\ \textasciigrave{}\ "f"\ ·\ (\textasciigrave{}\ "f"\ ·\ \textasciigrave{}\ "x")}
\item
  \texttt{ƛ\ "sam"\ ⇒\ ƛ\ "zelda"\ ⇒\ \textasciigrave{}\ "sam"\ ·\ (\textasciigrave{}\ "sam"\ ·\ \textasciigrave{}\ "zelda")}
\item
  \texttt{ƛ\ "z"\ ⇒\ ƛ\ "s"\ ⇒\ \textasciigrave{}\ "z"\ ·\ (\textasciigrave{}\ "z"\ ·\ \textasciigrave{}\ "s")}
\item
  \texttt{ƛ\ "😇"\ ⇒\ ƛ\ "😈"\ ⇒\ \textasciigrave{}\ "😇"\ ·\ (\textasciigrave{}\ "😇"\ ·\ \textasciigrave{}\ "😈"\ )}
\end{itemize}

are all considered equivalent. Following the convention introduced by
Haskell Curry, who used the Greek letter \texttt{α} (\emph{alpha}) to
label such rules, this equivalence relation is called \emph{alpha
renaming}.

As we descend from a term into its subterms, variables that are bound
may become free. Consider the following terms:

\begin{itemize}
\item
  \texttt{ƛ\ "s"\ ⇒\ ƛ\ "z"\ ⇒\ \textasciigrave{}\ "s"\ ·\ (\textasciigrave{}\ "s"\ ·\ \textasciigrave{}\ "z")}
  has both \texttt{s} and \texttt{z} as bound variables.
\item
  \texttt{ƛ\ "z"\ ⇒\ \textasciigrave{}\ "s"\ ·\ (\textasciigrave{}\ "s"\ ·\ \textasciigrave{}\ "z")}
  has \texttt{z} bound and \texttt{s} free.
\item
  \texttt{\textasciigrave{}\ "s"\ ·\ (\textasciigrave{}\ "s"\ ·\ \textasciigrave{}\ "z")}
  has both \texttt{s} and \texttt{z} as free variables.
\end{itemize}

We say that a term with no free variables is \emph{closed}; otherwise it
is \emph{open}. Of the three terms above, the first is closed and the
other two are open. We will focus on reduction of closed terms.

Different occurrences of a variable may be bound and free. In the term

\begin{myDisplay}
(ƛ "x" ⇒ ` "x") · ` "x"
\end{myDisplay}

the inner occurrence of \texttt{x} is bound while the outer occurrence
is free. By alpha renaming, the term above is equivalent to

\begin{myDisplay}
(ƛ "y" ⇒ ` "y") · ` "x"
\end{myDisplay}

in which \texttt{y} is bound and \texttt{x} is free. A common
convention, called the \emph{Barendregt convention}, is to use alpha
renaming to ensure that the bound variables in a term are distinct from
the free variables, which can avoid confusions that may arise if bound
and free variables have the same names.

Case and recursion also introduce bound variables, which are also
subject to alpha renaming. In the term

\begin{myDisplay}
μ "+" ⇒ ƛ "m" ⇒ ƛ "n" ⇒
  case ` "m"
    [zero⇒ ` "n"
    |suc "m" ⇒ `suc (` "+" · ` "m" · ` "n") ]
\end{myDisplay}

notice that there are two binding occurrences of \texttt{m}, one in the
first line and one in the last line. It is equivalent to the following
term,

\begin{myDisplay}
μ "plus" ⇒ ƛ "x" ⇒ ƛ "y" ⇒
  case ` "x"
    [zero⇒ ` "y"
    |suc "x′" ⇒ `suc (` "plus" · ` "x′" · ` "y") ]
\end{myDisplay}

where the two binding occurrences corresponding to \texttt{m} now have
distinct names, \texttt{x} and \texttt{x′}.

\hypertarget{values}{%
\section{Values}\label{values}}

A \emph{value} is a term that corresponds to an answer. Thus,
\texttt{\textasciigrave{}suc\ \textasciigrave{}suc\ \textasciigrave{}suc\ \textasciigrave{}suc\ \textasciigrave{}zero}
is a value, while \texttt{plus\ ·\ two\ ·\ two} is not. Following
convention, we treat all function abstractions as values; thus,
\texttt{plus} by itself is considered a value.

The predicate \texttt{Value\ M} holds if term \texttt{M} is a value:

\begin{fence}
\begin{code}%
\>[0]\AgdaKeyword{data}\AgdaSpace{}%
\AgdaDatatype{Value}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaPrimitiveType{Set}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaInductiveConstructor{V-ƛ}%
\>[290I]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{N}\AgdaSymbol{\}}\<%
\\
\>[.][@{}l@{}]\<[290I]%
\>[6]\AgdaComment{---------------}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Value}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{ƛ}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaBound{N}\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaInductiveConstructor{V-zero}\AgdaSpace{}%
\AgdaSymbol{:}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[6]\AgdaComment{-----------}\<%
\\
%
\>[6]\AgdaDatatype{Value}\AgdaSpace{}%
\AgdaInductiveConstructor{`zero}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaInductiveConstructor{V-suc}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{V}\AgdaSymbol{\}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaSymbol{→}%
\>[304I]\AgdaDatatype{Value}\AgdaSpace{}%
\AgdaBound{V}\<%
\\
\>[.][@{}l@{}]\<[304I]%
\>[6]\AgdaComment{--------------}\<%
\\
%
\>[4]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Value}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{`suc}}\AgdaSpace{}%
\AgdaBound{V}\AgdaSymbol{)}\<%
\end{code}
\end{fence}

In what follows, we let \texttt{V} and \texttt{W} range over values.

\hypertarget{formal-vs-informal-1}{%
\subsection{Formal vs informal}\label{formal-vs-informal-1}}

In informal presentations of formal semantics, using \texttt{V} as the
name of a metavariable is sufficient to indicate that it is a value. In
Agda, we must explicitly invoke the \texttt{Value} predicate.

\hypertarget{other-approaches}{%
\subsection{Other approaches}\label{other-approaches}}

An alternative is not to focus on closed terms, to treat variables as
values, and to treat \texttt{ƛ\ x\ ⇒\ N} as a value only if \texttt{N}
is a value. Indeed, this is how Agda normalises terms. We consider this
approach in Chapter \protect\hyperlink{Untyped}{Untyped}.

\hypertarget{substitution}{%
\section{Substitution}\label{substitution}}

The heart of lambda calculus is the operation of substituting one term
for a variable in another term. Substitution plays a key role in
defining the operational semantics of function application. For
instance, we have

\begin{myDisplay}
  (ƛ "s" ⇒ ƛ "z" ⇒ ` "s" · (` "s" · ` "z")) · sucᶜ · `zero
—→
  (ƛ "z" ⇒ sucᶜ · (sucᶜ · ` "z")) · `zero
—→
  sucᶜ · (sucᶜ · `zero)
\end{myDisplay}

where we substitute \texttt{sucᶜ} for \texttt{\textasciigrave{}\ "s"}
and \texttt{\textasciigrave{}zero} for \texttt{\textasciigrave{}\ "z"}
in the body of the function abstraction.

We write substitution as \texttt{N\ {[}\ x\ :=\ V\ {]}}, meaning
``substitute term \texttt{V} for free occurrences of variable \texttt{x}
in term \texttt{N}'', or, more compactly, ``substitute \texttt{V} for
\texttt{x} in \texttt{N}'', or equivalently, ``in \texttt{N} replace
\texttt{x} by \texttt{V}''. Substitution works if \texttt{V} is any
closed term; it need not be a value, but we use \texttt{V} since in fact
we usually substitute values.

Here are some examples:

\begin{itemize}
\tightlist
\item
  \texttt{(ƛ\ "z"\ ⇒\ \textasciigrave{}\ "s"\ ·\ (\textasciigrave{}\ "s"\ ·\ \textasciigrave{}\ "z"))\ {[}\ "s"\ :=\ sucᶜ\ {]}}
  yields \texttt{ƛ\ "z"\ ⇒\ sucᶜ\ ·\ (sucᶜ\ ·\ \textasciigrave{}\ "z")}.
\item
  \texttt{(sucᶜ\ ·\ (sucᶜ\ ·\ \textasciigrave{}\ "z"))\ {[}\ "z"\ :=\ \textasciigrave{}zero\ {]}}
  yields \texttt{sucᶜ\ ·\ (sucᶜ\ ·\ \textasciigrave{}zero)}.
\item
  \texttt{(ƛ\ "x"\ ⇒\ \textasciigrave{}\ "y")\ {[}\ "y"\ :=\ \textasciigrave{}zero\ {]}}
  yields \texttt{ƛ\ "x"\ ⇒\ \textasciigrave{}zero}.
\item
  \texttt{(ƛ\ "x"\ ⇒\ \textasciigrave{}\ "x")\ {[}\ "x"\ :=\ \textasciigrave{}zero\ {]}}
  yields \texttt{ƛ\ "x"\ ⇒\ \textasciigrave{}\ "x"}.
\item
  \texttt{(ƛ\ "y"\ ⇒\ \textasciigrave{}\ "y")\ {[}\ "x"\ :=\ \textasciigrave{}zero\ {]}}
  yields \texttt{ƛ\ "y"\ ⇒\ \textasciigrave{}\ "y"}.
\end{itemize}

In the last but one example, substituting \texttt{\textasciigrave{}zero}
for \texttt{x} in \texttt{ƛ\ "x"\ ⇒\ \textasciigrave{}\ "x"} does
\emph{not} yield \texttt{ƛ\ "x"\ ⇒\ \textasciigrave{}zero}, since
\texttt{x} is bound in the lambda abstraction. The choice of bound names
is irrelevant: both \texttt{ƛ\ "x"\ ⇒\ \textasciigrave{}\ "x"} and
\texttt{ƛ\ "y"\ ⇒\ \textasciigrave{}\ "y"} stand for the identity
function. One way to think of this is that \texttt{x} within the body of
the abstraction stands for a \emph{different} variable than \texttt{x}
outside the abstraction, they just happen to have the same name.

We will give a definition of substitution that is only valid when term
substituted for the variable is closed. This is because substitution by
terms that are \emph{not} closed may require renaming of bound
variables. For example:

\begin{itemize}
\tightlist
\item
  \texttt{(ƛ\ "x"\ ⇒\ \textasciigrave{}\ "x"\ ·\ \textasciigrave{}\ "y")\ {[}\ "y"\ :=\ \textasciigrave{}\ "x"\ ·\ \textasciigrave{}zero{]}}
  should not yield
  \texttt{(ƛ\ "x"\ ⇒\ \textasciigrave{}\ "x"\ ·\ (\textasciigrave{}\ "x"\ ·\ \textasciigrave{}zero))}.
\end{itemize}

Instead, we should rename the bound variable to avoid capture:

\begin{itemize}
\tightlist
\item
  \texttt{(ƛ\ "x"\ ⇒\ \textasciigrave{}\ "x"\ ·\ \textasciigrave{}\ "y")\ {[}\ "y"\ :=\ \textasciigrave{}\ "x"\ ·\ \textasciigrave{}zero\ {]}}
  should yield
  \texttt{ƛ\ "x′"\ ⇒\ \textasciigrave{}\ "x′"\ ·\ (\textasciigrave{}\ "x"\ ·\ \textasciigrave{}zero)}.
\end{itemize}

Here \texttt{x′} is a fresh variable distinct from \texttt{x}. Formal
definition of substitution with suitable renaming is considerably more
complex, so we avoid it by restricting to substitution by closed terms,
which will be adequate for our purposes.

Here is the formal definition of substitution by closed terms in Agda:

\begin{fence}
\begin{code}%
\>[0]\AgdaKeyword{infix}\AgdaSpace{}%
\AgdaNumber{9}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}[\AgdaUnderscore{}:=\AgdaUnderscore{}]}}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}[\AgdaUnderscore{}:=\AgdaUnderscore{}]}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{Id}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Term}\<%
\\
\>[0]\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{[}}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{:=}}\AgdaSpace{}%
\AgdaBound{V}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaKeyword{with}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{≟}}\AgdaSpace{}%
\AgdaBound{y}\<%
\\
\>[0]\AgdaSymbol{...}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaInductiveConstructor{yes}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}%
\>[21]\AgdaSymbol{=}%
\>[24]\AgdaBound{V}\<%
\\
\>[0]\AgdaSymbol{...}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaInductiveConstructor{no}%
\>[10]\AgdaSymbol{\AgdaUnderscore{}}%
\>[21]\AgdaSymbol{=}%
\>[24]\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaBound{x}\<%
\\
\>[0]\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{ƛ}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaBound{N}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{[}}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{:=}}\AgdaSpace{}%
\AgdaBound{V}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaKeyword{with}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{≟}}\AgdaSpace{}%
\AgdaBound{y}\<%
\\
\>[0]\AgdaSymbol{...}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaInductiveConstructor{yes}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}%
\>[21]\AgdaSymbol{=}%
\>[24]\AgdaOperator{\AgdaInductiveConstructor{ƛ}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaBound{N}\<%
\\
\>[0]\AgdaSymbol{...}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaInductiveConstructor{no}%
\>[10]\AgdaSymbol{\AgdaUnderscore{}}%
\>[21]\AgdaSymbol{=}%
\>[24]\AgdaOperator{\AgdaInductiveConstructor{ƛ}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaBound{N}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{[}}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{:=}}\AgdaSpace{}%
\AgdaBound{V}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\<%
\\
\>[0]\AgdaSymbol{(}\AgdaBound{L}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaBound{M}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{[}}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{:=}}\AgdaSpace{}%
\AgdaBound{V}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}%
\>[21]\AgdaSymbol{=}%
\>[24]\AgdaBound{L}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{[}}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{:=}}\AgdaSpace{}%
\AgdaBound{V}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaBound{M}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{[}}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{:=}}\AgdaSpace{}%
\AgdaBound{V}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\<%
\\
\>[0]\AgdaSymbol{(}\AgdaInductiveConstructor{`zero}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{[}}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{:=}}\AgdaSpace{}%
\AgdaBound{V}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}%
\>[21]\AgdaSymbol{=}%
\>[24]\AgdaInductiveConstructor{`zero}\<%
\\
\>[0]\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{`suc}}\AgdaSpace{}%
\AgdaBound{M}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{[}}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{:=}}\AgdaSpace{}%
\AgdaBound{V}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}%
\>[21]\AgdaSymbol{=}%
\>[24]\AgdaOperator{\AgdaInductiveConstructor{`suc}}\AgdaSpace{}%
\AgdaBound{M}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{[}}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{:=}}\AgdaSpace{}%
\AgdaBound{V}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\<%
\\
\>[0]\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{case}}\AgdaSpace{}%
\AgdaBound{L}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{[zero⇒}}\AgdaSpace{}%
\AgdaBound{M}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{|suc}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaBound{N}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{]}}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{[}}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{:=}}\AgdaSpace{}%
\AgdaBound{V}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaKeyword{with}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{≟}}\AgdaSpace{}%
\AgdaBound{y}\<%
\\
\>[0]\AgdaSymbol{...}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaInductiveConstructor{yes}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}%
\>[21]\AgdaSymbol{=}%
\>[24]\AgdaOperator{\AgdaInductiveConstructor{case}}\AgdaSpace{}%
\AgdaBound{L}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{[}}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{:=}}\AgdaSpace{}%
\AgdaBound{V}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{[zero⇒}}\AgdaSpace{}%
\AgdaBound{M}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{[}}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{:=}}\AgdaSpace{}%
\AgdaBound{V}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{|suc}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaBound{N}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{]}}\<%
\\
\>[0]\AgdaSymbol{...}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaInductiveConstructor{no}%
\>[10]\AgdaSymbol{\AgdaUnderscore{}}%
\>[21]\AgdaSymbol{=}%
\>[24]\AgdaOperator{\AgdaInductiveConstructor{case}}\AgdaSpace{}%
\AgdaBound{L}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{[}}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{:=}}\AgdaSpace{}%
\AgdaBound{V}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{[zero⇒}}\AgdaSpace{}%
\AgdaBound{M}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{[}}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{:=}}\AgdaSpace{}%
\AgdaBound{V}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{|suc}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaBound{N}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{[}}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{:=}}\AgdaSpace{}%
\AgdaBound{V}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{]}}\<%
\\
\>[0]\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{μ}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaBound{N}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{[}}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{:=}}\AgdaSpace{}%
\AgdaBound{V}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaKeyword{with}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{≟}}\AgdaSpace{}%
\AgdaBound{y}\<%
\\
\>[0]\AgdaSymbol{...}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaInductiveConstructor{yes}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}%
\>[21]\AgdaSymbol{=}%
\>[24]\AgdaOperator{\AgdaInductiveConstructor{μ}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaBound{N}\<%
\\
\>[0]\AgdaSymbol{...}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaInductiveConstructor{no}%
\>[10]\AgdaSymbol{\AgdaUnderscore{}}%
\>[21]\AgdaSymbol{=}%
\>[24]\AgdaOperator{\AgdaInductiveConstructor{μ}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaBound{N}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{[}}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{:=}}\AgdaSpace{}%
\AgdaBound{V}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\<%
\end{code}
\end{fence}

Let's unpack the first three cases:

\begin{itemize}
\item
  For variables, we compare \texttt{y}, the substituted variable, with
  \texttt{x}, the variable in the term. If they are the same, we yield
  \texttt{V}, otherwise we yield \texttt{x} unchanged.
\item
  For abstractions, we compare \texttt{y}, the substituted variable,
  with \texttt{x}, the variable bound in the abstraction. If they are
  the same, we yield the abstraction unchanged, otherwise we substitute
  inside the body.
\item
  For application, we recursively substitute in the function and the
  argument.
\end{itemize}

Case expressions and recursion also have bound variables that are
treated similarly to those in lambda abstractions. Otherwise we simply
push substitution recursively into the subterms.

\hypertarget{examples}{%
\subsection{Examples}\label{examples}}

Here is confirmation that the examples above are correct:

\begin{fence}
\begin{code}%
\>[0]\AgdaFunction{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{ƛ}}\AgdaSpace{}%
\AgdaString{"z"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaString{"s"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaString{"s"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaString{"z"}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{[}}\AgdaSpace{}%
\AgdaString{"s"}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{:=}}\AgdaSpace{}%
\AgdaFunction{sucᶜ}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≡}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{ƛ}}\AgdaSpace{}%
\AgdaString{"z"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaFunction{sucᶜ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{sucᶜ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaString{"z"}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{sucᶜ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{sucᶜ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaString{"z"}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{[}}\AgdaSpace{}%
\AgdaString{"z"}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{:=}}\AgdaSpace{}%
\AgdaInductiveConstructor{`zero}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≡}}\AgdaSpace{}%
\AgdaFunction{sucᶜ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{sucᶜ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaInductiveConstructor{`zero}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{ƛ}}\AgdaSpace{}%
\AgdaString{"x"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaString{"y"}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{[}}\AgdaSpace{}%
\AgdaString{"y"}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{:=}}\AgdaSpace{}%
\AgdaInductiveConstructor{`zero}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≡}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{ƛ}}\AgdaSpace{}%
\AgdaString{"x"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaInductiveConstructor{`zero}\<%
\\
\>[0]\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{ƛ}}\AgdaSpace{}%
\AgdaString{"x"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaString{"x"}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{[}}\AgdaSpace{}%
\AgdaString{"x"}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{:=}}\AgdaSpace{}%
\AgdaInductiveConstructor{`zero}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≡}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{ƛ}}\AgdaSpace{}%
\AgdaString{"x"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaString{"x"}\<%
\\
\>[0]\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{ƛ}}\AgdaSpace{}%
\AgdaString{"y"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaString{"y"}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{[}}\AgdaSpace{}%
\AgdaString{"x"}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{:=}}\AgdaSpace{}%
\AgdaInductiveConstructor{`zero}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≡}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{ƛ}}\AgdaSpace{}%
\AgdaString{"y"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaString{"y"}\<%
\\
\>[0]\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\<%
\end{code}
\end{fence}

\hypertarget{quiz}{%
\subsubsection{Quiz}\label{quiz}}

What is the result of the following substitution?

\begin{myDisplay}
(ƛ "y" ⇒ ` "x" · (ƛ "x" ⇒ ` "x")) [ "x" := `zero ]
\end{myDisplay}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  \texttt{(ƛ\ "y"\ ⇒\ \textasciigrave{}\ "x"\ ·\ (ƛ\ "x"\ ⇒\ \textasciigrave{}\ "x"))}
\item
  \texttt{(ƛ\ "y"\ ⇒\ \textasciigrave{}\ "x"\ ·\ (ƛ\ "x"\ ⇒\ \textasciigrave{}zero))}
\item
  \texttt{(ƛ\ "y"\ ⇒\ \textasciigrave{}zero\ ·\ (ƛ\ "x"\ ⇒\ \textasciigrave{}\ "x"))}
\item
  \texttt{(ƛ\ "y"\ ⇒\ \textasciigrave{}zero\ ·\ (ƛ\ "x"\ ⇒\ \textasciigrave{}zero))}
\end{enumerate}

\hypertarget{exercise-___-stretch}{%
\subsubsection{\texorpdfstring{Exercise \texttt{\_{[}\_:=\_{]}′}
(stretch)}{Exercise \_{[}\_:=\_{]}′ (stretch)}}\label{exercise-___-stretch}}

The definition of substitution above has three clauses (\texttt{ƛ},
\texttt{case}, and \texttt{μ}) that invoke a \texttt{with} clause to
deal with bound variables. Rewrite the definition to factor the common
part of these three clauses into a single function, defined by mutual
recursion with substitution.

\begin{fence}
\begin{code}%
\>[0]\AgdaComment{-- Your code goes here}\<%
\end{code}
\end{fence}

\hypertarget{reduction}{%
\section{Reduction}\label{reduction}}

We give the reduction rules for call-by-value lambda calculus. To reduce
an application, first we reduce the left-hand side until it becomes a
value (which must be an abstraction); then we reduce the right-hand side
until it becomes a value; and finally we substitute the argument for the
variable in the abstraction.

In an informal presentation of the operational semantics, the rules for
reduction of applications are written as follows:

\begin{myDisplay}
L —→ L′
--------------- ξ-·₁
L · M —→ L′ · M

M —→ M′
--------------- ξ-·₂
V · M —→ V · M′

----------------------------- β-ƛ
(ƛ x ⇒ N) · V —→ N [ x := V ]
\end{myDisplay}

The Agda version of the rules below will be similar, except that
universal quantifications are made explicit, and so are the predicates
that indicate which terms are values.

The rules break into two sorts. Compatibility rules direct us to reduce
some part of a term. We give them names starting with the Greek letter
\texttt{ξ} (\emph{xi}). Once a term is sufficiently reduced, it will
consist of a constructor and a deconstructor, in our case \texttt{ƛ} and
\texttt{·}, which reduces directly. We give them names starting with the
Greek letter \texttt{β} (\emph{beta}) and such rules are traditionally
called \emph{beta rules}.

A bit of terminology: A term that matches the left-hand side of a
reduction rule is called a \emph{redex}. In the redex
\texttt{(ƛ\ x\ ⇒\ N)\ ·\ V}, we may refer to \texttt{x} as the
\emph{formal parameter} of the function, and \texttt{V} as the
\emph{actual parameter} of the function application. Beta reduction
replaces the formal parameter by the actual parameter.

If a term is a value, then no reduction applies; conversely, if a
reduction applies to a term then it is not a value. We will show in the
next chapter that this exhausts the possibilities: every well-typed term
either reduces or is a value.

For numbers, zero does not reduce and successor reduces the subterm. A
case expression reduces its argument to a number, and then chooses the
zero or successor branch as appropriate. A fixpoint replaces the bound
variable by the entire fixpoint term; this is the one case where we
substitute by a term that is not a value.

Here are the rules formalised in Agda:

\begin{fence}
\begin{code}%
\>[0]\AgdaKeyword{infix}\AgdaSpace{}%
\AgdaNumber{4}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{\AgdaUnderscore{}—→\AgdaUnderscore{}}}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaKeyword{data}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{\AgdaUnderscore{}—→\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaPrimitiveType{Set}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaInductiveConstructor{ξ-·₁}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{L}\AgdaSpace{}%
\AgdaBound{L′}\AgdaSpace{}%
\AgdaBound{M}\AgdaSymbol{\}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaSymbol{→}%
\>[610I]\AgdaBound{L}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{—→}}\AgdaSpace{}%
\AgdaBound{L′}\<%
\\
\>[.][@{}l@{}]\<[610I]%
\>[6]\AgdaComment{-----------------}\<%
\\
%
\>[4]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{L}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaBound{M}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{—→}}\AgdaSpace{}%
\AgdaBound{L′}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaBound{M}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaInductiveConstructor{ξ-·₂}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{V}\AgdaSpace{}%
\AgdaBound{M}\AgdaSpace{}%
\AgdaBound{M′}\AgdaSymbol{\}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Value}\AgdaSpace{}%
\AgdaBound{V}\<%
\\
%
\>[4]\AgdaSymbol{→}%
\>[627I]\AgdaBound{M}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{—→}}\AgdaSpace{}%
\AgdaBound{M′}\<%
\\
\>[.][@{}l@{}]\<[627I]%
\>[6]\AgdaComment{-----------------}\<%
\\
%
\>[4]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{V}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaBound{M}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{—→}}\AgdaSpace{}%
\AgdaBound{V}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaBound{M′}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaInductiveConstructor{β-ƛ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{N}\AgdaSpace{}%
\AgdaBound{V}\AgdaSymbol{\}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaSymbol{→}%
\>[642I]\AgdaDatatype{Value}\AgdaSpace{}%
\AgdaBound{V}\<%
\\
\>[.][@{}l@{}]\<[642I]%
\>[6]\AgdaComment{------------------------------}\<%
\\
%
\>[4]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{ƛ}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaBound{N}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaBound{V}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{—→}}\AgdaSpace{}%
\AgdaBound{N}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{[}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{:=}}\AgdaSpace{}%
\AgdaBound{V}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaInductiveConstructor{ξ-suc}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{M}\AgdaSpace{}%
\AgdaBound{M′}\AgdaSymbol{\}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaSymbol{→}%
\>[661I]\AgdaBound{M}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{—→}}\AgdaSpace{}%
\AgdaBound{M′}\<%
\\
\>[.][@{}l@{}]\<[661I]%
\>[6]\AgdaComment{------------------}\<%
\\
%
\>[4]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`suc}}\AgdaSpace{}%
\AgdaBound{M}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{—→}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`suc}}\AgdaSpace{}%
\AgdaBound{M′}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaInductiveConstructor{ξ-case}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{L}\AgdaSpace{}%
\AgdaBound{L′}\AgdaSpace{}%
\AgdaBound{M}\AgdaSpace{}%
\AgdaBound{N}\AgdaSymbol{\}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaSymbol{→}%
\>[676I]\AgdaBound{L}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{—→}}\AgdaSpace{}%
\AgdaBound{L′}\<%
\\
\>[.][@{}l@{}]\<[676I]%
\>[6]\AgdaComment{-----------------------------------------------------------------}\<%
\\
%
\>[4]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{case}}\AgdaSpace{}%
\AgdaBound{L}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{[zero⇒}}\AgdaSpace{}%
\AgdaBound{M}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{|suc}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaBound{N}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{—→}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{case}}\AgdaSpace{}%
\AgdaBound{L′}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{[zero⇒}}\AgdaSpace{}%
\AgdaBound{M}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{|suc}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaBound{N}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{]}}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaInductiveConstructor{β-zero}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{M}\AgdaSpace{}%
\AgdaBound{N}\AgdaSymbol{\}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[6]\AgdaComment{----------------------------------------}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{case}}\AgdaSpace{}%
\AgdaInductiveConstructor{`zero}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{[zero⇒}}\AgdaSpace{}%
\AgdaBound{M}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{|suc}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaBound{N}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{—→}}\AgdaSpace{}%
\AgdaBound{M}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaInductiveConstructor{β-suc}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{V}\AgdaSpace{}%
\AgdaBound{M}\AgdaSpace{}%
\AgdaBound{N}\AgdaSymbol{\}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaSymbol{→}%
\>[720I]\AgdaDatatype{Value}\AgdaSpace{}%
\AgdaBound{V}\<%
\\
\>[.][@{}l@{}]\<[720I]%
\>[6]\AgdaComment{---------------------------------------------------}\<%
\\
%
\>[4]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{case}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`suc}}\AgdaSpace{}%
\AgdaBound{V}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{[zero⇒}}\AgdaSpace{}%
\AgdaBound{M}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{|suc}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaBound{N}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{—→}}\AgdaSpace{}%
\AgdaBound{N}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{[}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{:=}}\AgdaSpace{}%
\AgdaBound{V}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaInductiveConstructor{β-μ}%
\>[739I]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{M}\AgdaSymbol{\}}\<%
\\
\>[.][@{}l@{}]\<[739I]%
\>[6]\AgdaComment{------------------------------}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{μ}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaBound{M}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{—→}}\AgdaSpace{}%
\AgdaBound{M}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{[}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{:=}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{μ}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaBound{M}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{]}}\<%
\end{code}
\end{fence}

The reduction rules are carefully designed to ensure that subterms of a
term are reduced to values before the whole term is reduced. This is
referred to as \emph{call-by-value} reduction.

Further, we have arranged that subterms are reduced in a left-to-right
order. This means that reduction is \emph{deterministic}: for any term,
there is at most one other term to which it reduces. Put another way,
our reduction relation \texttt{—→} is in fact a function.

This style of explaining the meaning of terms is called a
\emph{small-step operational semantics}. If \texttt{M\ —→\ N}, we say
that term \texttt{M} \emph{reduces} to term \texttt{N}, or equivalently,
term \texttt{M} \emph{steps} to term \texttt{N}. Each compatibility rule
has another reduction rule in its premise; so a step always consists of
a beta rule, possibly adjusted by zero or more compatibility rules.

\hypertarget{quiz-1}{%
\subsubsection{Quiz}\label{quiz-1}}

What does the following term step to?

\begin{myDisplay}
(ƛ "x" ⇒ ` "x") · (ƛ "x" ⇒ ` "x")  —→  ???
\end{myDisplay}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  \texttt{(ƛ\ "x"\ ⇒\ \textasciigrave{}\ "x")}
\item
  \texttt{(ƛ\ "x"\ ⇒\ \textasciigrave{}\ "x")\ ·\ (ƛ\ "x"\ ⇒\ \textasciigrave{}\ "x")}
\item
  \texttt{(ƛ\ "x"\ ⇒\ \textasciigrave{}\ "x")\ ·\ (ƛ\ "x"\ ⇒\ \textasciigrave{}\ "x")\ ·\ (ƛ\ "x"\ ⇒\ \textasciigrave{}\ "x")}
\end{enumerate}

What does the following term step to?

\begin{myDisplay}
(ƛ "x" ⇒ ` "x") · (ƛ "x" ⇒ ` "x") · (ƛ "x" ⇒ ` "x")  —→  ???
\end{myDisplay}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  \texttt{(ƛ\ "x"\ ⇒\ \textasciigrave{}\ "x")}
\item
  \texttt{(ƛ\ "x"\ ⇒\ \textasciigrave{}\ "x")\ ·\ (ƛ\ "x"\ ⇒\ \textasciigrave{}\ "x")}
\item
  \texttt{(ƛ\ "x"\ ⇒\ \textasciigrave{}\ "x")\ ·\ (ƛ\ "x"\ ⇒\ \textasciigrave{}\ "x")\ ·\ (ƛ\ "x"\ ⇒\ \textasciigrave{}\ "x")}
\end{enumerate}

What does the following term step to? (Where \texttt{twoᶜ} and
\texttt{sucᶜ} are as defined above.)

\begin{myDisplay}
twoᶜ · sucᶜ · `zero  —→  ???
\end{myDisplay}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  \texttt{sucᶜ\ ·\ (sucᶜ\ ·\ \textasciigrave{}zero)}
\item
  \texttt{(ƛ\ "z"\ ⇒\ sucᶜ\ ·\ (sucᶜ\ ·\ \textasciigrave{}\ "z"))\ ·\ \textasciigrave{}zero}
\item
  \texttt{\textasciigrave{}zero}
\end{enumerate}

\hypertarget{reflexive-and-transitive-closure}{%
\section{Reflexive and transitive
closure}\label{reflexive-and-transitive-closure}}

A single step is only part of the story. In general, we wish to
repeatedly step a closed term until it reduces to a value. We do this by
defining the reflexive and transitive closure \texttt{—↠} of the step
relation \texttt{—→}.

We define reflexive and transitive closure as a sequence of zero or more
steps of the underlying relation, along lines similar to that for
reasoning about chains of equalities in Chapter
\protect\hyperlink{Equality}{Equality}:

\begin{fence}
\begin{code}%
\>[0]\AgdaKeyword{infix}%
\>[7]\AgdaNumber{2}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{\AgdaUnderscore{}—↠\AgdaUnderscore{}}}\<%
\\
\>[0]\AgdaKeyword{infix}%
\>[7]\AgdaNumber{1}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{begin\AgdaUnderscore{}}}\<%
\\
\>[0]\AgdaKeyword{infixr}\AgdaSpace{}%
\AgdaNumber{2}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{\AgdaUnderscore{}—→⟨\AgdaUnderscore{}⟩\AgdaUnderscore{}}}\<%
\\
\>[0]\AgdaKeyword{infix}%
\>[7]\AgdaNumber{3}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{\AgdaUnderscore{}∎}}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaKeyword{data}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{\AgdaUnderscore{}—↠\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaPrimitiveType{Set}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaOperator{\AgdaInductiveConstructor{\AgdaUnderscore{}∎}}%
\>[770I]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaBound{M}\<%
\\
\>[770I][@{}l@{\AgdaIndent{0}}]%
\>[6]\AgdaComment{---------}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{M}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{—↠}}\AgdaSpace{}%
\AgdaBound{M}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaOperator{\AgdaInductiveConstructor{\AgdaUnderscore{}—→⟨\AgdaUnderscore{}⟩\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaBound{L}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{M}\AgdaSpace{}%
\AgdaBound{N}\AgdaSymbol{\}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{L}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{—→}}\AgdaSpace{}%
\AgdaBound{M}\<%
\\
%
\>[4]\AgdaSymbol{→}%
\>[784I]\AgdaBound{M}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{—↠}}\AgdaSpace{}%
\AgdaBound{N}\<%
\\
\>[.][@{}l@{}]\<[784I]%
\>[6]\AgdaComment{---------}\<%
\\
%
\>[4]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{L}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{—↠}}\AgdaSpace{}%
\AgdaBound{N}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaOperator{\AgdaFunction{begin\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{M}\AgdaSpace{}%
\AgdaBound{N}\AgdaSymbol{\}}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaSymbol{→}%
\>[794I]\AgdaBound{M}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{—↠}}\AgdaSpace{}%
\AgdaBound{N}\<%
\\
\>[.][@{}l@{}]\<[794I]%
\>[4]\AgdaComment{------}\<%
\\
%
\>[2]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{M}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{—↠}}\AgdaSpace{}%
\AgdaBound{N}\<%
\\
\>[0]\AgdaOperator{\AgdaFunction{begin}}\AgdaSpace{}%
\AgdaBound{M—↠N}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{M—↠N}\<%
\end{code}
\end{fence}

We can read this as follows:

\begin{itemize}
\item
  From term \texttt{M}, we can take no steps, giving a step of type
  \texttt{M\ —↠\ M}. It is written \texttt{M\ ∎}.
\item
  From term \texttt{L} we can take a single step of type
  \texttt{L\ —→\ M} followed by zero or more steps of type
  \texttt{M\ —↠\ N}, giving a step of type \texttt{L\ —↠\ N}. It is
  written \texttt{L\ —→⟨\ L—→M\ ⟩\ M—↠N}, where \texttt{L—→M} and
  \texttt{M—↠N} are steps of the appropriate type.
\end{itemize}

The notation is chosen to allow us to lay out example reductions in an
appealing way, as we will see in the next section.

An alternative is to define reflexive and transitive closure directly,
as the smallest relation that includes \texttt{—→} and is also reflexive
and transitive. We could do so as follows:

\begin{fence}
\begin{code}%
\>[0]\AgdaKeyword{data}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{\AgdaUnderscore{}—↠′\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaPrimitiveType{Set}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaInductiveConstructor{step′}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{M}\AgdaSpace{}%
\AgdaBound{N}\AgdaSymbol{\}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaSymbol{→}%
\>[815I]\AgdaBound{M}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{—→}}\AgdaSpace{}%
\AgdaBound{N}\<%
\\
\>[.][@{}l@{}]\<[815I]%
\>[6]\AgdaComment{-------}\<%
\\
%
\>[4]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{M}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{—↠′}}\AgdaSpace{}%
\AgdaBound{N}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaInductiveConstructor{refl′}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{M}\AgdaSymbol{\}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[6]\AgdaComment{-------}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{M}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{—↠′}}\AgdaSpace{}%
\AgdaBound{M}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaInductiveConstructor{trans′}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{L}\AgdaSpace{}%
\AgdaBound{M}\AgdaSpace{}%
\AgdaBound{N}\AgdaSymbol{\}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{L}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{—↠′}}\AgdaSpace{}%
\AgdaBound{M}\<%
\\
%
\>[4]\AgdaSymbol{→}%
\>[835I]\AgdaBound{M}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{—↠′}}\AgdaSpace{}%
\AgdaBound{N}\<%
\\
\>[.][@{}l@{}]\<[835I]%
\>[6]\AgdaComment{-------}\<%
\\
%
\>[4]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{L}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{—↠′}}\AgdaSpace{}%
\AgdaBound{N}\<%
\end{code}
\end{fence}

The three constructors specify, respectively, that \texttt{—↠′} includes
\texttt{—→} and is reflexive and transitive. A good exercise is to show
that the two definitions are equivalent (indeed, one embeds in the
other).

\hypertarget{exercise-practice}{%
\subsubsection{\texorpdfstring{Exercise \texttt{—↠≲—↠′}
(practice)}{Exercise ---↠≲---↠′ (practice)}}\label{exercise-practice}}

Show that the first notion of reflexive and transitive closure above
embeds into the second. Why are they not isomorphic?

\begin{fence}
\begin{code}%
\>[0]\AgdaComment{-- Your code goes here}\<%
\end{code}
\end{fence}

\hypertarget{confluence}{%
\section{Confluence}\label{confluence}}

One important property a reduction relation might satisfy is to be
\emph{confluent}. If term \texttt{L} reduces to two other terms,
\texttt{M} and \texttt{N}, then both of these reduce to a common term
\texttt{P}. It can be illustrated as follows:

\begin{myDisplay}
           L
          / \
         /   \
        /     \
       M       N
        \     /
         \   /
          \ /
           P
\end{myDisplay}

Here \texttt{L}, \texttt{M}, \texttt{N} are universally quantified while
\texttt{P} is existentially quantified. If each line stands for zero or
more reduction steps, this is called confluence, while if the top two
lines stand for a single reduction step and the bottom two stand for
zero or more reduction steps it is called the diamond property. In
symbols:

\begin{fence}
\begin{code}%
\>[0]\AgdaKeyword{postulate}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaPostulate{confluence}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{L}\AgdaSpace{}%
\AgdaBound{M}\AgdaSpace{}%
\AgdaBound{N}\AgdaSymbol{\}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaSymbol{→}%
\>[846I]\AgdaSymbol{((}\AgdaBound{L}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{—↠}}\AgdaSpace{}%
\AgdaBound{M}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{×}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{L}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{—↠}}\AgdaSpace{}%
\AgdaBound{N}\AgdaSymbol{))}\<%
\\
\>[.][@{}l@{}]\<[846I]%
\>[6]\AgdaComment{--------------------}\<%
\\
%
\>[4]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{∃[}\AgdaSpace{}%
\AgdaBound{P}\AgdaSpace{}%
\AgdaFunction{]}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{M}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{—↠}}\AgdaSpace{}%
\AgdaBound{P}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{×}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{N}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{—↠}}\AgdaSpace{}%
\AgdaBound{P}\AgdaSymbol{))}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaPostulate{diamond}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{L}\AgdaSpace{}%
\AgdaBound{M}\AgdaSpace{}%
\AgdaBound{N}\AgdaSymbol{\}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaSymbol{→}%
\>[868I]\AgdaSymbol{((}\AgdaBound{L}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{—→}}\AgdaSpace{}%
\AgdaBound{M}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{×}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{L}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{—→}}\AgdaSpace{}%
\AgdaBound{N}\AgdaSymbol{))}\<%
\\
\>[.][@{}l@{}]\<[868I]%
\>[6]\AgdaComment{--------------------}\<%
\\
%
\>[4]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{∃[}\AgdaSpace{}%
\AgdaBound{P}\AgdaSpace{}%
\AgdaFunction{]}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaBound{M}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{—↠}}\AgdaSpace{}%
\AgdaBound{P}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{×}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{N}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{—↠}}\AgdaSpace{}%
\AgdaBound{P}\AgdaSymbol{))}\<%
\end{code}
\end{fence}

The reduction system studied in this chapter is deterministic. In
symbols:

\begin{fence}
\begin{code}%
\>[0]\AgdaKeyword{postulate}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaPostulate{deterministic}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{L}\AgdaSpace{}%
\AgdaBound{M}\AgdaSpace{}%
\AgdaBound{N}\AgdaSymbol{\}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{L}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{—→}}\AgdaSpace{}%
\AgdaBound{M}\<%
\\
%
\>[4]\AgdaSymbol{→}%
\>[893I]\AgdaBound{L}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{—→}}\AgdaSpace{}%
\AgdaBound{N}\<%
\\
\>[.][@{}l@{}]\<[893I]%
\>[6]\AgdaComment{------}\<%
\\
%
\>[4]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{M}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≡}}\AgdaSpace{}%
\AgdaBound{N}\<%
\end{code}
\end{fence}

It is easy to show that every deterministic relation satisfies the
diamond and confluence properties. Hence, all the reduction systems
studied in this text are trivially confluent.

\hypertarget{examples-1}{%
\section{Examples}\label{examples-1}}

We start with a simple example. The Church numeral two applied to the
successor function and zero yields the natural number two:

\begin{fence}
\begin{code}%
\>[0]\AgdaFunction{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{twoᶜ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaFunction{sucᶜ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaInductiveConstructor{`zero}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{—↠}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`suc}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`suc}}\AgdaSpace{}%
\AgdaInductiveConstructor{`zero}\<%
\\
\>[0]\AgdaSymbol{\AgdaUnderscore{}}%
\>[909I]\AgdaSymbol{=}\<%
\\
\>[.][@{}l@{}]\<[909I]%
\>[2]\AgdaOperator{\AgdaFunction{begin}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaFunction{twoᶜ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaFunction{sucᶜ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaInductiveConstructor{`zero}\<%
\\
%
\>[2]\AgdaOperator{\AgdaInductiveConstructor{—→⟨}}\AgdaSpace{}%
\AgdaInductiveConstructor{ξ-·₁}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{β-ƛ}\AgdaSpace{}%
\AgdaInductiveConstructor{V-ƛ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⟩}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{ƛ}}\AgdaSpace{}%
\AgdaString{"z"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaFunction{sucᶜ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{sucᶜ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaString{"z"}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaInductiveConstructor{`zero}\<%
\\
%
\>[2]\AgdaOperator{\AgdaInductiveConstructor{—→⟨}}\AgdaSpace{}%
\AgdaInductiveConstructor{β-ƛ}\AgdaSpace{}%
\AgdaInductiveConstructor{V-zero}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⟩}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaFunction{sucᶜ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{sucᶜ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaInductiveConstructor{`zero}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaOperator{\AgdaInductiveConstructor{—→⟨}}\AgdaSpace{}%
\AgdaInductiveConstructor{ξ-·₂}\AgdaSpace{}%
\AgdaInductiveConstructor{V-ƛ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{β-ƛ}\AgdaSpace{}%
\AgdaInductiveConstructor{V-zero}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⟩}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaFunction{sucᶜ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`suc}}\AgdaSpace{}%
\AgdaInductiveConstructor{`zero}\<%
\\
%
\>[2]\AgdaOperator{\AgdaInductiveConstructor{—→⟨}}\AgdaSpace{}%
\AgdaInductiveConstructor{β-ƛ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{V-suc}\AgdaSpace{}%
\AgdaInductiveConstructor{V-zero}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⟩}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaOperator{\AgdaInductiveConstructor{`suc}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{`suc}}\AgdaSpace{}%
\AgdaInductiveConstructor{`zero}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaOperator{\AgdaInductiveConstructor{∎}}\<%
\end{code}
\end{fence}

Here is a sample reduction demonstrating that two plus two is four:

\begin{fence}
\begin{code}%
\>[0]\AgdaFunction{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{plus}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaFunction{two}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaFunction{two}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{—↠}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`suc}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`suc}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`suc}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`suc}}\AgdaSpace{}%
\AgdaInductiveConstructor{`zero}\<%
\\
\>[0]\AgdaSymbol{\AgdaUnderscore{}}%
\>[961I]\AgdaSymbol{=}\<%
\\
\>[.][@{}l@{}]\<[961I]%
\>[2]\AgdaOperator{\AgdaFunction{begin}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaFunction{plus}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaFunction{two}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaFunction{two}\<%
\\
%
\>[2]\AgdaOperator{\AgdaInductiveConstructor{—→⟨}}\AgdaSpace{}%
\AgdaInductiveConstructor{ξ-·₁}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{ξ-·₁}\AgdaSpace{}%
\AgdaInductiveConstructor{β-μ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⟩}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{ƛ}}\AgdaSpace{}%
\AgdaString{"m"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{ƛ}}\AgdaSpace{}%
\AgdaString{"n"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\<%
\\
\>[4][@{}l@{\AgdaIndent{0}}]%
\>[6]\AgdaOperator{\AgdaInductiveConstructor{case}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaString{"m"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{[zero⇒}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaString{"n"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{|suc}}\AgdaSpace{}%
\AgdaString{"m"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`suc}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{plus}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaString{"m"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaString{"n"}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{]}}\AgdaSymbol{)}\<%
\\
\>[6][@{}l@{\AgdaIndent{0}}]%
\>[8]\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaFunction{two}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaFunction{two}\<%
\\
%
\>[2]\AgdaOperator{\AgdaInductiveConstructor{—→⟨}}\AgdaSpace{}%
\AgdaInductiveConstructor{ξ-·₁}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{β-ƛ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{V-suc}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{V-suc}\AgdaSpace{}%
\AgdaInductiveConstructor{V-zero}\AgdaSymbol{)))}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⟩}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{ƛ}}\AgdaSpace{}%
\AgdaString{"n"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\<%
\\
\>[4][@{}l@{\AgdaIndent{0}}]%
\>[6]\AgdaOperator{\AgdaInductiveConstructor{case}}\AgdaSpace{}%
\AgdaFunction{two}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{[zero⇒}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaString{"n"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{|suc}}\AgdaSpace{}%
\AgdaString{"m"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`suc}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{plus}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaString{"m"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaString{"n"}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{]}}\AgdaSymbol{)}\<%
\\
\>[6][@{}l@{\AgdaIndent{0}}]%
\>[9]\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaFunction{two}\<%
\\
%
\>[2]\AgdaOperator{\AgdaInductiveConstructor{—→⟨}}\AgdaSpace{}%
\AgdaInductiveConstructor{β-ƛ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{V-suc}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{V-suc}\AgdaSpace{}%
\AgdaInductiveConstructor{V-zero}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⟩}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaOperator{\AgdaInductiveConstructor{case}}\AgdaSpace{}%
\AgdaFunction{two}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{[zero⇒}}\AgdaSpace{}%
\AgdaFunction{two}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{|suc}}\AgdaSpace{}%
\AgdaString{"m"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`suc}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{plus}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaString{"m"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaFunction{two}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{]}}\<%
\\
%
\>[2]\AgdaOperator{\AgdaInductiveConstructor{—→⟨}}\AgdaSpace{}%
\AgdaInductiveConstructor{β-suc}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{V-suc}\AgdaSpace{}%
\AgdaInductiveConstructor{V-zero}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⟩}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaOperator{\AgdaInductiveConstructor{`suc}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{plus}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`suc}}\AgdaSpace{}%
\AgdaInductiveConstructor{`zero}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaFunction{two}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaOperator{\AgdaInductiveConstructor{—→⟨}}\AgdaSpace{}%
\AgdaInductiveConstructor{ξ-suc}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{ξ-·₁}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{ξ-·₁}\AgdaSpace{}%
\AgdaInductiveConstructor{β-μ}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⟩}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaOperator{\AgdaInductiveConstructor{`suc}}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaOperator{\AgdaInductiveConstructor{ƛ}}\AgdaSpace{}%
\AgdaString{"m"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{ƛ}}\AgdaSpace{}%
\AgdaString{"n"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\<%
\\
\>[4][@{}l@{\AgdaIndent{0}}]%
\>[6]\AgdaOperator{\AgdaInductiveConstructor{case}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaString{"m"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{[zero⇒}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaString{"n"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{|suc}}\AgdaSpace{}%
\AgdaString{"m"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`suc}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{plus}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaString{"m"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaString{"n"}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{]}}\AgdaSymbol{)}\<%
\\
\>[6][@{}l@{\AgdaIndent{0}}]%
\>[8]\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`suc}}\AgdaSpace{}%
\AgdaInductiveConstructor{`zero}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaFunction{two}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaOperator{\AgdaInductiveConstructor{—→⟨}}\AgdaSpace{}%
\AgdaInductiveConstructor{ξ-suc}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{ξ-·₁}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{β-ƛ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{V-suc}\AgdaSpace{}%
\AgdaInductiveConstructor{V-zero}\AgdaSymbol{)))}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⟩}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaOperator{\AgdaInductiveConstructor{`suc}}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaOperator{\AgdaInductiveConstructor{ƛ}}\AgdaSpace{}%
\AgdaString{"n"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\<%
\\
\>[4][@{}l@{\AgdaIndent{0}}]%
\>[6]\AgdaOperator{\AgdaInductiveConstructor{case}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`suc}}\AgdaSpace{}%
\AgdaInductiveConstructor{`zero}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{[zero⇒}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaString{"n"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{|suc}}\AgdaSpace{}%
\AgdaString{"m"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`suc}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{plus}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaString{"m"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaString{"n"}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{]}}\AgdaSymbol{)}\<%
\\
\>[6][@{}l@{\AgdaIndent{0}}]%
\>[8]\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaFunction{two}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaOperator{\AgdaInductiveConstructor{—→⟨}}\AgdaSpace{}%
\AgdaInductiveConstructor{ξ-suc}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{β-ƛ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{V-suc}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{V-suc}\AgdaSpace{}%
\AgdaInductiveConstructor{V-zero}\AgdaSymbol{)))}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⟩}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaOperator{\AgdaInductiveConstructor{`suc}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{case}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`suc}}\AgdaSpace{}%
\AgdaInductiveConstructor{`zero}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{[zero⇒}}\AgdaSpace{}%
\AgdaFunction{two}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{|suc}}\AgdaSpace{}%
\AgdaString{"m"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`suc}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{plus}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaString{"m"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaFunction{two}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{]}}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaOperator{\AgdaInductiveConstructor{—→⟨}}\AgdaSpace{}%
\AgdaInductiveConstructor{ξ-suc}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{β-suc}\AgdaSpace{}%
\AgdaInductiveConstructor{V-zero}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⟩}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaOperator{\AgdaInductiveConstructor{`suc}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`suc}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{plus}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaInductiveConstructor{`zero}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaFunction{two}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaOperator{\AgdaInductiveConstructor{—→⟨}}\AgdaSpace{}%
\AgdaInductiveConstructor{ξ-suc}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{ξ-suc}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{ξ-·₁}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{ξ-·₁}\AgdaSpace{}%
\AgdaInductiveConstructor{β-μ}\AgdaSymbol{)))}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⟩}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaOperator{\AgdaInductiveConstructor{`suc}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`suc}}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaOperator{\AgdaInductiveConstructor{ƛ}}\AgdaSpace{}%
\AgdaString{"m"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{ƛ}}\AgdaSpace{}%
\AgdaString{"n"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\<%
\\
\>[4][@{}l@{\AgdaIndent{0}}]%
\>[6]\AgdaOperator{\AgdaInductiveConstructor{case}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaString{"m"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{[zero⇒}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaString{"n"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{|suc}}\AgdaSpace{}%
\AgdaString{"m"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`suc}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{plus}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaString{"m"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaString{"n"}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{]}}\AgdaSymbol{)}\<%
\\
\>[6][@{}l@{\AgdaIndent{0}}]%
\>[8]\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaInductiveConstructor{`zero}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaFunction{two}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaOperator{\AgdaInductiveConstructor{—→⟨}}\AgdaSpace{}%
\AgdaInductiveConstructor{ξ-suc}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{ξ-suc}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{ξ-·₁}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{β-ƛ}\AgdaSpace{}%
\AgdaInductiveConstructor{V-zero}\AgdaSymbol{)))}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⟩}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaOperator{\AgdaInductiveConstructor{`suc}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`suc}}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaOperator{\AgdaInductiveConstructor{ƛ}}\AgdaSpace{}%
\AgdaString{"n"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\<%
\\
\>[4][@{}l@{\AgdaIndent{0}}]%
\>[6]\AgdaOperator{\AgdaInductiveConstructor{case}}\AgdaSpace{}%
\AgdaInductiveConstructor{`zero}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{[zero⇒}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaString{"n"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{|suc}}\AgdaSpace{}%
\AgdaString{"m"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`suc}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{plus}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaString{"m"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaString{"n"}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{]}}\AgdaSymbol{)}\<%
\\
\>[6][@{}l@{\AgdaIndent{0}}]%
\>[8]\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaFunction{two}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaOperator{\AgdaInductiveConstructor{—→⟨}}\AgdaSpace{}%
\AgdaInductiveConstructor{ξ-suc}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{ξ-suc}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{β-ƛ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{V-suc}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{V-suc}\AgdaSpace{}%
\AgdaInductiveConstructor{V-zero}\AgdaSymbol{))))}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⟩}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaOperator{\AgdaInductiveConstructor{`suc}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`suc}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{case}}\AgdaSpace{}%
\AgdaInductiveConstructor{`zero}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{[zero⇒}}\AgdaSpace{}%
\AgdaFunction{two}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{|suc}}\AgdaSpace{}%
\AgdaString{"m"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`suc}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{plus}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaString{"m"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaFunction{two}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{]}}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaOperator{\AgdaInductiveConstructor{—→⟨}}\AgdaSpace{}%
\AgdaInductiveConstructor{ξ-suc}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{ξ-suc}\AgdaSpace{}%
\AgdaInductiveConstructor{β-zero}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⟩}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaOperator{\AgdaInductiveConstructor{`suc}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{`suc}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{`suc}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{`suc}}\AgdaSpace{}%
\AgdaInductiveConstructor{`zero}\AgdaSymbol{)))}\<%
\\
%
\>[2]\AgdaOperator{\AgdaInductiveConstructor{∎}}\<%
\end{code}
\end{fence}

And here is a similar sample reduction for Church numerals:

\begin{fence}
\begin{code}%
\>[0]\AgdaFunction{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{plusᶜ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaFunction{twoᶜ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaFunction{twoᶜ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaFunction{sucᶜ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaInductiveConstructor{`zero}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{—↠}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`suc}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`suc}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`suc}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`suc}}\AgdaSpace{}%
\AgdaInductiveConstructor{`zero}\<%
\\
\>[0]\AgdaSymbol{\AgdaUnderscore{}}%
\>[1247I]\AgdaSymbol{=}\<%
\\
\>[.][@{}l@{}]\<[1247I]%
\>[2]\AgdaOperator{\AgdaFunction{begin}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{ƛ}}\AgdaSpace{}%
\AgdaString{"m"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{ƛ}}\AgdaSpace{}%
\AgdaString{"n"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{ƛ}}\AgdaSpace{}%
\AgdaString{"s"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{ƛ}}\AgdaSpace{}%
\AgdaString{"z"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaString{"m"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaString{"s"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaString{"n"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaString{"s"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaString{"z"}\AgdaSymbol{))}\<%
\\
\>[4][@{}l@{\AgdaIndent{0}}]%
\>[6]\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaFunction{twoᶜ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaFunction{twoᶜ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaFunction{sucᶜ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaInductiveConstructor{`zero}\<%
\\
%
\>[2]\AgdaOperator{\AgdaInductiveConstructor{—→⟨}}\AgdaSpace{}%
\AgdaInductiveConstructor{ξ-·₁}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{ξ-·₁}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{ξ-·₁}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{β-ƛ}\AgdaSpace{}%
\AgdaInductiveConstructor{V-ƛ}\AgdaSymbol{)))}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⟩}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{ƛ}}\AgdaSpace{}%
\AgdaString{"n"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{ƛ}}\AgdaSpace{}%
\AgdaString{"s"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{ƛ}}\AgdaSpace{}%
\AgdaString{"z"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaFunction{twoᶜ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaString{"s"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaString{"n"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaString{"s"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaString{"z"}\AgdaSymbol{))}\<%
\\
\>[4][@{}l@{\AgdaIndent{0}}]%
\>[6]\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaFunction{twoᶜ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaFunction{sucᶜ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaInductiveConstructor{`zero}\<%
\\
%
\>[2]\AgdaOperator{\AgdaInductiveConstructor{—→⟨}}\AgdaSpace{}%
\AgdaInductiveConstructor{ξ-·₁}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{ξ-·₁}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{β-ƛ}\AgdaSpace{}%
\AgdaInductiveConstructor{V-ƛ}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⟩}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{ƛ}}\AgdaSpace{}%
\AgdaString{"s"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{ƛ}}\AgdaSpace{}%
\AgdaString{"z"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaFunction{twoᶜ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaString{"s"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{twoᶜ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaString{"s"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaString{"z"}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaFunction{sucᶜ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaInductiveConstructor{`zero}\<%
\\
%
\>[2]\AgdaOperator{\AgdaInductiveConstructor{—→⟨}}\AgdaSpace{}%
\AgdaInductiveConstructor{ξ-·₁}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{β-ƛ}\AgdaSpace{}%
\AgdaInductiveConstructor{V-ƛ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⟩}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{ƛ}}\AgdaSpace{}%
\AgdaString{"z"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaFunction{twoᶜ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaFunction{sucᶜ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{twoᶜ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaFunction{sucᶜ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaString{"z"}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaInductiveConstructor{`zero}\<%
\\
%
\>[2]\AgdaOperator{\AgdaInductiveConstructor{—→⟨}}\AgdaSpace{}%
\AgdaInductiveConstructor{β-ƛ}\AgdaSpace{}%
\AgdaInductiveConstructor{V-zero}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⟩}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaFunction{twoᶜ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaFunction{sucᶜ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{twoᶜ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaFunction{sucᶜ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaInductiveConstructor{`zero}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaOperator{\AgdaInductiveConstructor{—→⟨}}\AgdaSpace{}%
\AgdaInductiveConstructor{ξ-·₁}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{β-ƛ}\AgdaSpace{}%
\AgdaInductiveConstructor{V-ƛ}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⟩}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{ƛ}}\AgdaSpace{}%
\AgdaString{"z"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaFunction{sucᶜ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{sucᶜ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaString{"z"}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{twoᶜ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaFunction{sucᶜ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaInductiveConstructor{`zero}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaOperator{\AgdaInductiveConstructor{—→⟨}}\AgdaSpace{}%
\AgdaInductiveConstructor{ξ-·₂}\AgdaSpace{}%
\AgdaInductiveConstructor{V-ƛ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{ξ-·₁}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{β-ƛ}\AgdaSpace{}%
\AgdaInductiveConstructor{V-ƛ}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⟩}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{ƛ}}\AgdaSpace{}%
\AgdaString{"z"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaFunction{sucᶜ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{sucᶜ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaString{"z"}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaSymbol{((}\AgdaOperator{\AgdaInductiveConstructor{ƛ}}\AgdaSpace{}%
\AgdaString{"z"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaFunction{sucᶜ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{sucᶜ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaString{"z"}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaInductiveConstructor{`zero}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaOperator{\AgdaInductiveConstructor{—→⟨}}\AgdaSpace{}%
\AgdaInductiveConstructor{ξ-·₂}\AgdaSpace{}%
\AgdaInductiveConstructor{V-ƛ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{β-ƛ}\AgdaSpace{}%
\AgdaInductiveConstructor{V-zero}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⟩}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{ƛ}}\AgdaSpace{}%
\AgdaString{"z"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaFunction{sucᶜ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{sucᶜ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaString{"z"}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{sucᶜ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{sucᶜ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaInductiveConstructor{`zero}\AgdaSymbol{))}\<%
\\
%
\>[2]\AgdaOperator{\AgdaInductiveConstructor{—→⟨}}\AgdaSpace{}%
\AgdaInductiveConstructor{ξ-·₂}\AgdaSpace{}%
\AgdaInductiveConstructor{V-ƛ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{ξ-·₂}\AgdaSpace{}%
\AgdaInductiveConstructor{V-ƛ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{β-ƛ}\AgdaSpace{}%
\AgdaInductiveConstructor{V-zero}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⟩}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{ƛ}}\AgdaSpace{}%
\AgdaString{"z"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaFunction{sucᶜ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{sucᶜ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaString{"z"}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{sucᶜ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{`suc}}\AgdaSpace{}%
\AgdaInductiveConstructor{`zero}\AgdaSymbol{))}\<%
\\
%
\>[2]\AgdaOperator{\AgdaInductiveConstructor{—→⟨}}\AgdaSpace{}%
\AgdaInductiveConstructor{ξ-·₂}\AgdaSpace{}%
\AgdaInductiveConstructor{V-ƛ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{β-ƛ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{V-suc}\AgdaSpace{}%
\AgdaInductiveConstructor{V-zero}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⟩}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{ƛ}}\AgdaSpace{}%
\AgdaString{"z"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaFunction{sucᶜ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{sucᶜ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaString{"z"}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{`suc}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`suc}}\AgdaSpace{}%
\AgdaInductiveConstructor{`zero}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaOperator{\AgdaInductiveConstructor{—→⟨}}\AgdaSpace{}%
\AgdaInductiveConstructor{β-ƛ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{V-suc}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{V-suc}\AgdaSpace{}%
\AgdaInductiveConstructor{V-zero}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⟩}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaFunction{sucᶜ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{sucᶜ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`suc}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`suc}}\AgdaSpace{}%
\AgdaInductiveConstructor{`zero}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaOperator{\AgdaInductiveConstructor{—→⟨}}\AgdaSpace{}%
\AgdaInductiveConstructor{ξ-·₂}\AgdaSpace{}%
\AgdaInductiveConstructor{V-ƛ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{β-ƛ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{V-suc}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{V-suc}\AgdaSpace{}%
\AgdaInductiveConstructor{V-zero}\AgdaSymbol{)))}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⟩}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaFunction{sucᶜ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{`suc}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`suc}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`suc}}\AgdaSpace{}%
\AgdaInductiveConstructor{`zero}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaOperator{\AgdaInductiveConstructor{—→⟨}}\AgdaSpace{}%
\AgdaInductiveConstructor{β-ƛ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{V-suc}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{V-suc}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{V-suc}\AgdaSpace{}%
\AgdaInductiveConstructor{V-zero}\AgdaSymbol{)))}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⟩}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[3]\AgdaOperator{\AgdaInductiveConstructor{`suc}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{`suc}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{`suc}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaOperator{\AgdaInductiveConstructor{`suc}}\AgdaSpace{}%
\AgdaInductiveConstructor{`zero}\AgdaSymbol{)))}\<%
\\
%
\>[2]\AgdaOperator{\AgdaInductiveConstructor{∎}}\<%
\end{code}
\end{fence}

In the next chapter, we will see how to compute such reduction
sequences.

\hypertarget{exercise-plus-example-practice}{%
\subsubsection{\texorpdfstring{Exercise \texttt{plus-example}
(practice)}{Exercise plus-example (practice)}}\label{exercise-plus-example-practice}}

Write out the reduction sequence demonstrating that one plus one is two.

\begin{fence}
\begin{code}%
\>[0]\AgdaComment{-- Your code goes here}\<%
\end{code}
\end{fence}

\hypertarget{syntax-of-types}{%
\section{Syntax of types}\label{syntax-of-types}}

We have just two types:

\begin{itemize}
\tightlist
\item
  Functions, \texttt{A\ ⇒\ B}
\item
  Naturals, \texttt{\textasciigrave{}ℕ}
\end{itemize}

As before, to avoid overlap we use variants of the names used by Agda.

Here is the syntax of types in BNF:

\begin{myDisplay}
A, B, C  ::=  A ⇒ B | `ℕ
\end{myDisplay}

And here it is formalised in Agda:

\begin{fence}
\begin{code}%
\>[0]\AgdaKeyword{infixr}\AgdaSpace{}%
\AgdaNumber{7}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{\AgdaUnderscore{}⇒\AgdaUnderscore{}}}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaKeyword{data}\AgdaSpace{}%
\AgdaDatatype{Type}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitiveType{Set}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaOperator{\AgdaInductiveConstructor{\AgdaUnderscore{}⇒\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Type}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Type}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Type}\<%
\\
%
\>[2]\AgdaInductiveConstructor{`ℕ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Type}\<%
\end{code}
\end{fence}

\hypertarget{precedence}{%
\subsection{Precedence}\label{precedence}}

As in Agda, functions of two or more arguments are represented via
currying. This is made more convenient by declaring \texttt{\_⇒\_} to
associate to the right and \texttt{\_·\_} to associate to the left.
Thus:

\begin{itemize}
\tightlist
\item
  \texttt{(\textasciigrave{}ℕ\ ⇒\ \textasciigrave{}ℕ)\ ⇒\ \textasciigrave{}ℕ\ ⇒\ \textasciigrave{}ℕ}
  stands for
  \texttt{((\textasciigrave{}ℕ\ ⇒\ \textasciigrave{}ℕ)\ ⇒\ (\textasciigrave{}ℕ\ ⇒\ \textasciigrave{}ℕ))}.
\item
  \texttt{plus\ ·\ two\ ·\ two} stands for
  \texttt{(plus\ ·\ two)\ ·\ two}.
\end{itemize}

\hypertarget{quiz-2}{%
\subsection{Quiz}\label{quiz-2}}

\begin{itemize}
\item
  What is the type of the following term?

  \texttt{ƛ\ "s"\ ⇒\ \textasciigrave{}\ "s"\ ·\ (\textasciigrave{}\ "s"\ \ ·\ \textasciigrave{}zero)}

  \begin{enumerate}
  \def\labelenumi{\arabic{enumi}.}
  \tightlist
  \item
    \texttt{(\textasciigrave{}ℕ\ ⇒\ \textasciigrave{}ℕ)\ ⇒\ (\textasciigrave{}ℕ\ ⇒\ \textasciigrave{}ℕ)}
  \item
    \texttt{(\textasciigrave{}ℕ\ ⇒\ \textasciigrave{}ℕ)\ ⇒\ \textasciigrave{}ℕ}
  \item
    \texttt{\textasciigrave{}ℕ\ ⇒\ (\textasciigrave{}ℕ\ ⇒\ \textasciigrave{}ℕ)}
  \item
    \texttt{\textasciigrave{}ℕ\ ⇒\ \textasciigrave{}ℕ\ ⇒\ \textasciigrave{}ℕ}
  \item
    \texttt{\textasciigrave{}ℕ\ ⇒\ \textasciigrave{}ℕ}
  \item
    \texttt{\textasciigrave{}ℕ}
  \end{enumerate}

  Give more than one answer if appropriate.
\item
  What is the type of the following term?

  \texttt{(ƛ\ "s"\ ⇒\ \textasciigrave{}\ "s"\ ·\ (\textasciigrave{}\ "s"\ \ ·\ \textasciigrave{}zero))\ ·\ sucᶜ}

  \begin{enumerate}
  \def\labelenumi{\arabic{enumi}.}
  \tightlist
  \item
    \texttt{(\textasciigrave{}ℕ\ ⇒\ \textasciigrave{}ℕ)\ ⇒\ (\textasciigrave{}ℕ\ ⇒\ \textasciigrave{}ℕ)}
  \item
    \texttt{(\textasciigrave{}ℕ\ ⇒\ \textasciigrave{}ℕ)\ ⇒\ \textasciigrave{}ℕ}
  \item
    \texttt{\textasciigrave{}ℕ\ ⇒\ (\textasciigrave{}ℕ\ ⇒\ \textasciigrave{}ℕ)}
  \item
    \texttt{\textasciigrave{}ℕ\ ⇒\ \textasciigrave{}ℕ\ ⇒\ \textasciigrave{}ℕ}
  \item
    \texttt{\textasciigrave{}ℕ\ ⇒\ \textasciigrave{}ℕ}
  \item
    \texttt{\textasciigrave{}ℕ}
  \end{enumerate}

  Give more than one answer if appropriate.
\end{itemize}

\hypertarget{typing}{%
\section{Typing}\label{typing}}

\hypertarget{contexts}{%
\subsection{Contexts}\label{contexts}}

While reduction considers only closed terms, typing must consider terms
with free variables. To type a term, we must first type its subterms,
and in particular in the body of an abstraction its bound variable may
appear free.

A \emph{context} associates variables with types. We let \texttt{Γ} and
\texttt{Δ} range over contexts. We write \texttt{∅} for the empty
context, and \texttt{Γ\ ,\ x\ ⦂\ A} for the context that extends
\texttt{Γ} by mapping variable \texttt{x} to type \texttt{A}. For
example,

\begin{itemize}
\tightlist
\item
  \texttt{∅\ ,\ "s"\ ⦂\ \textasciigrave{}ℕ\ ⇒\ \textasciigrave{}ℕ\ ,\ "z"\ ⦂\ \textasciigrave{}ℕ}
\end{itemize}

is the context that associates variable \texttt{"s"} with type
\texttt{\textasciigrave{}ℕ\ ⇒\ \textasciigrave{}ℕ}, and variable
\texttt{"z"} with type \texttt{\textasciigrave{}ℕ}.

Contexts are formalised as follows:

\begin{fence}
\begin{code}%
\>[0]\AgdaKeyword{infixl}\AgdaSpace{}%
\AgdaNumber{5}%
\>[10]\AgdaOperator{\AgdaInductiveConstructor{\AgdaUnderscore{},\AgdaUnderscore{}⦂\AgdaUnderscore{}}}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaKeyword{data}\AgdaSpace{}%
\AgdaDatatype{Context}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitiveType{Set}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaInductiveConstructor{∅}%
\>[8]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Context}\<%
\\
%
\>[2]\AgdaOperator{\AgdaInductiveConstructor{\AgdaUnderscore{},\AgdaUnderscore{}⦂\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Context}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{Id}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Type}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Context}\<%
\end{code}
\end{fence}

\hypertarget{exercise-context--practice}{%
\subsubsection{\texorpdfstring{Exercise \texttt{Context-≃}
(practice)}{Exercise Context-≃ (practice)}}\label{exercise-context--practice}}

Show that \texttt{Context} is isomorphic to
\texttt{List\ (Id\ ×\ Type)}. For instance, the isomorphism relates the
context

\begin{myDisplay}
∅ , "s" ⦂ `ℕ ⇒ `ℕ , "z" ⦂ `ℕ
\end{myDisplay}

to the list

\begin{myDisplay}
[ ⟨ "z" , `ℕ ⟩ , ⟨ "s" , `ℕ ⇒ `ℕ ⟩ ]
\end{myDisplay}

\begin{fence}
\begin{code}%
\>[0]\AgdaComment{-- Your code goes here}\<%
\end{code}
\end{fence}

\hypertarget{lookup-judgment}{%
\subsection{Lookup judgment}\label{lookup-judgment}}

We have two forms of \emph{judgment}. The first is written

\begin{myDisplay}
Γ ∋ x ⦂ A
\end{myDisplay}

and indicates in context \texttt{Γ} that variable \texttt{x} has type
\texttt{A}. It is called \emph{lookup}. For example,

\begin{itemize}
\tightlist
\item
  \texttt{∅\ ,\ "s"\ ⦂\ \textasciigrave{}ℕ\ ⇒\ \textasciigrave{}ℕ\ ,\ "z"\ ⦂\ \textasciigrave{}ℕ\ ∋\ "z"\ ⦂\ \textasciigrave{}ℕ}
\item
  \texttt{∅\ ,\ "s"\ ⦂\ \textasciigrave{}ℕ\ ⇒\ \textasciigrave{}ℕ\ ,\ "z"\ ⦂\ \textasciigrave{}ℕ\ ∋\ "s"\ ⦂\ \textasciigrave{}ℕ\ ⇒\ \textasciigrave{}ℕ}
\end{itemize}

give us the types associated with variables \texttt{"z"} and
\texttt{"s"}, respectively. The symbol \texttt{∋} (pronounced ``ni'',
for ``in'' backwards) is chosen because checking that
\texttt{Γ\ ∋\ x\ ⦂\ A} is analogous to checking whether \texttt{x\ ⦂\ A}
appears in a list corresponding to \texttt{Γ}.

If two variables in a context have the same name, then lookup should
return the most recently bound variable, which \emph{shadows} the other
variables. For example,

\begin{itemize}
\tightlist
\item
  \texttt{∅\ ,\ "x"\ ⦂\ \textasciigrave{}ℕ\ ⇒\ \textasciigrave{}ℕ\ ,\ "x"\ ⦂\ \textasciigrave{}ℕ\ ∋\ "x"\ ⦂\ \textasciigrave{}ℕ}.
\end{itemize}

Here \texttt{"x"\ ⦂\ \textasciigrave{}ℕ\ ⇒\ \textasciigrave{}ℕ} is
shadowed by \texttt{"x"\ ⦂\ \textasciigrave{}ℕ}.

Lookup is formalised as follows:

\begin{fence}
\begin{code}%
\>[0]\AgdaKeyword{infix}%
\>[7]\AgdaNumber{4}%
\>[10]\AgdaOperator{\AgdaDatatype{\AgdaUnderscore{}∋\AgdaUnderscore{}⦂\AgdaUnderscore{}}}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaKeyword{data}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{\AgdaUnderscore{}∋\AgdaUnderscore{}⦂\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Context}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{Id}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Type}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaPrimitiveType{Set}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaInductiveConstructor{Z}%
\>[1539I]\AgdaSymbol{:}%
\>[1540I]\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{A}\AgdaSymbol{\}}\<%
\\
\>[.][@{}l@{}]\<[1540I]%
\>[6]\AgdaComment{------------------}\<%
\\
\>[.][@{}l@{}]\<[1539I]%
\>[4]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{Γ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⦂}}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{∋}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{⦂}}\AgdaSpace{}%
\AgdaBound{A}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaInductiveConstructor{S}%
\>[1553I]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{B}\AgdaSymbol{\}}\<%
\\
\>[.][@{}l@{}]\<[1553I]%
\>[4]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{≢}}\AgdaSpace{}%
\AgdaBound{y}\<%
\\
%
\>[4]\AgdaSymbol{→}%
\>[1563I]\AgdaBound{Γ}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{∋}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{⦂}}\AgdaSpace{}%
\AgdaBound{A}\<%
\\
\>[.][@{}l@{}]\<[1563I]%
\>[6]\AgdaComment{------------------}\<%
\\
%
\>[4]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{Γ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⦂}}\AgdaSpace{}%
\AgdaBound{B}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{∋}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{⦂}}\AgdaSpace{}%
\AgdaBound{A}\<%
\end{code}
\end{fence}

The constructors \texttt{Z} and \texttt{S} correspond roughly to the
constructors \texttt{here} and \texttt{there} for the element-of
relation \texttt{\_∈\_} on lists. Constructor \texttt{S} takes an
additional parameter, which ensures that when we look up a variable that
it is not \emph{shadowed} by another variable with the same name to its
left in the list.

It can be rather tedious to use the \texttt{S} constructor, as you have
to provide proofs that \texttt{x\ ≢\ y} each time. For example:

\begin{fence}
\begin{code}%
\>[0]\AgdaFunction{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaInductiveConstructor{∅}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaString{"x"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⦂}}\AgdaSpace{}%
\AgdaInductiveConstructor{`ℕ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaInductiveConstructor{`ℕ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaString{"y"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⦂}}\AgdaSpace{}%
\AgdaInductiveConstructor{`ℕ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaString{"z"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⦂}}\AgdaSpace{}%
\AgdaInductiveConstructor{`ℕ}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{∋}}\AgdaSpace{}%
\AgdaString{"x"}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{⦂}}\AgdaSpace{}%
\AgdaInductiveConstructor{`ℕ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaInductiveConstructor{`ℕ}\<%
\\
\>[0]\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{S}\AgdaSpace{}%
\AgdaSymbol{(λ())}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{S}\AgdaSpace{}%
\AgdaSymbol{(λ())}\AgdaSpace{}%
\AgdaInductiveConstructor{Z}\AgdaSymbol{)}\<%
\end{code}
\end{fence}

Instead, we'll use a ``smart constructor'', which uses
\protect\hyperlink{Decidable-proof-by-reflection}{proof by reflection}
to check the inequality while type checking:

\begin{fence}
\begin{code}%
\>[0]\AgdaFunction{S′}%
\>[1605I]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{B}\AgdaSymbol{\}}\<%
\\
\>[.][@{}l@{}]\<[1605I]%
\>[3]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{x≢y}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{False}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{≟}}\AgdaSpace{}%
\AgdaBound{y}\AgdaSymbol{)\}}\<%
\\
%
\>[3]\AgdaSymbol{→}%
\>[1618I]\AgdaBound{Γ}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{∋}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{⦂}}\AgdaSpace{}%
\AgdaBound{A}\<%
\\
\>[.][@{}l@{}]\<[1618I]%
\>[5]\AgdaComment{------------------}\<%
\\
%
\>[3]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{Γ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{y}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⦂}}\AgdaSpace{}%
\AgdaBound{B}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{∋}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{⦂}}\AgdaSpace{}%
\AgdaBound{A}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{S′}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaArgument{x≢y}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{x≢y}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{S}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{toWitnessFalse}\AgdaSpace{}%
\AgdaBound{x≢y}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{x}\<%
\end{code}
\end{fence}

\hypertarget{typing-judgment}{%
\subsection{Typing judgment}\label{typing-judgment}}

The second judgment is written

\begin{myDisplay}
Γ ⊢ M ⦂ A
\end{myDisplay}

and indicates in context \texttt{Γ} that term \texttt{M} has type
\texttt{A}. Context \texttt{Γ} provides types for all the free variables
in \texttt{M}. For example:

\begin{itemize}
\tightlist
\item
  \texttt{∅\ ,\ "s"\ ⦂\ \textasciigrave{}ℕ\ ⇒\ \textasciigrave{}ℕ\ ,\ "z"\ ⦂\ \textasciigrave{}ℕ\ ⊢\ \textasciigrave{}\ "z"\ ⦂\ \textasciigrave{}ℕ}
\item
  \texttt{∅\ ,\ "s"\ ⦂\ \textasciigrave{}ℕ\ ⇒\ \textasciigrave{}ℕ\ ,\ "z"\ ⦂\ \textasciigrave{}ℕ\ ⊢\ \textasciigrave{}\ "s"\ ⦂\ \textasciigrave{}ℕ\ ⇒\ \textasciigrave{}ℕ}
\item
  \texttt{∅\ ,\ "s"\ ⦂\ \textasciigrave{}ℕ\ ⇒\ \textasciigrave{}ℕ\ ,\ "z"\ ⦂\ \textasciigrave{}ℕ\ ⊢\ \textasciigrave{}\ "s"\ ·\ \textasciigrave{}\ "z"\ ⦂\ \ \textasciigrave{}ℕ}
\item
  \texttt{∅\ ,\ "s"\ ⦂\ \textasciigrave{}ℕ\ ⇒\ \textasciigrave{}ℕ\ ,\ "z"\ ⦂\ \textasciigrave{}ℕ\ ⊢\ \textasciigrave{}\ "s"\ ·\ (\textasciigrave{}\ "s"\ ·\ \textasciigrave{}\ "z")\ ⦂\ \ \textasciigrave{}ℕ}
\item
  \texttt{∅\ ,\ "s"\ ⦂\ \textasciigrave{}ℕ\ ⇒\ \textasciigrave{}ℕ\ ⊢\ ƛ\ "z"\ ⇒\ \textasciigrave{}\ "s"\ ·\ (\textasciigrave{}\ "s"\ ·\ \textasciigrave{}\ "z")\ ⦂\ \ \textasciigrave{}ℕ\ ⇒\ \textasciigrave{}ℕ}
\item
  \texttt{∅\ ⊢\ ƛ\ "s"\ ⇒\ ƛ\ "z"\ ⇒\ \textasciigrave{}\ "s"\ ·\ (\textasciigrave{}\ "s"\ ·\ \textasciigrave{}\ "z")\ ⦂\ \ (\textasciigrave{}ℕ\ ⇒\ \textasciigrave{}ℕ)\ ⇒\ \textasciigrave{}ℕ\ ⇒\ \textasciigrave{}ℕ}
\end{itemize}

Typing is formalised as follows:

\begin{fence}
\begin{code}%
\>[0]\AgdaKeyword{infix}%
\>[7]\AgdaNumber{4}%
\>[10]\AgdaOperator{\AgdaDatatype{\AgdaUnderscore{}⊢\AgdaUnderscore{}⦂\AgdaUnderscore{}}}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaKeyword{data}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{\AgdaUnderscore{}⊢\AgdaUnderscore{}⦂\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Context}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Term}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Type}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaPrimitiveType{Set}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaComment{-- Axiom}\<%
\\
%
\>[2]\AgdaInductiveConstructor{⊢`}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{A}\AgdaSymbol{\}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaSymbol{→}%
\>[1656I]\AgdaBound{Γ}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{∋}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{⦂}}\AgdaSpace{}%
\AgdaBound{A}\<%
\\
\>[.][@{}l@{}]\<[1656I]%
\>[6]\AgdaComment{-----------}\<%
\\
%
\>[4]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{Γ}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{⊢}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{⦂}}\AgdaSpace{}%
\AgdaBound{A}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaComment{-- ⇒-I}\<%
\\
%
\>[2]\AgdaInductiveConstructor{⊢ƛ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{N}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{B}\AgdaSymbol{\}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaSymbol{→}%
\>[1674I]\AgdaBound{Γ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⦂}}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{⊢}}\AgdaSpace{}%
\AgdaBound{N}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{⦂}}\AgdaSpace{}%
\AgdaBound{B}\<%
\\
\>[.][@{}l@{}]\<[1674I]%
\>[6]\AgdaComment{-------------------}\<%
\\
%
\>[4]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{Γ}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{⊢}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{ƛ}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaBound{N}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{⦂}}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaBound{B}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaComment{-- ⇒-E}\<%
\\
%
\>[2]\AgdaOperator{\AgdaInductiveConstructor{\AgdaUnderscore{}·\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSpace{}%
\AgdaBound{L}\AgdaSpace{}%
\AgdaBound{M}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{B}\AgdaSymbol{\}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{Γ}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{⊢}}\AgdaSpace{}%
\AgdaBound{L}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{⦂}}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaBound{B}\<%
\\
%
\>[4]\AgdaSymbol{→}%
\>[1707I]\AgdaBound{Γ}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{⊢}}\AgdaSpace{}%
\AgdaBound{M}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{⦂}}\AgdaSpace{}%
\AgdaBound{A}\<%
\\
\>[.][@{}l@{}]\<[1707I]%
\>[6]\AgdaComment{-------------}\<%
\\
%
\>[4]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{Γ}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{⊢}}\AgdaSpace{}%
\AgdaBound{L}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaBound{M}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{⦂}}\AgdaSpace{}%
\AgdaBound{B}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaComment{-- ℕ-I₁}\<%
\\
%
\>[2]\AgdaInductiveConstructor{⊢zero}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSymbol{\}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[6]\AgdaComment{--------------}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{Γ}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{⊢}}\AgdaSpace{}%
\AgdaInductiveConstructor{`zero}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{⦂}}\AgdaSpace{}%
\AgdaInductiveConstructor{`ℕ}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaComment{-- ℕ-I₂}\<%
\\
%
\>[2]\AgdaInductiveConstructor{⊢suc}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSpace{}%
\AgdaBound{M}\AgdaSymbol{\}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaSymbol{→}%
\>[1731I]\AgdaBound{Γ}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{⊢}}\AgdaSpace{}%
\AgdaBound{M}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{⦂}}\AgdaSpace{}%
\AgdaInductiveConstructor{`ℕ}\<%
\\
\>[.][@{}l@{}]\<[1731I]%
\>[6]\AgdaComment{---------------}\<%
\\
%
\>[4]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{Γ}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{⊢}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`suc}}\AgdaSpace{}%
\AgdaBound{M}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{⦂}}\AgdaSpace{}%
\AgdaInductiveConstructor{`ℕ}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaComment{-- ℕ-E}\<%
\\
%
\>[2]\AgdaInductiveConstructor{⊢case}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSpace{}%
\AgdaBound{L}\AgdaSpace{}%
\AgdaBound{M}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{N}\AgdaSpace{}%
\AgdaBound{A}\AgdaSymbol{\}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{Γ}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{⊢}}\AgdaSpace{}%
\AgdaBound{L}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{⦂}}\AgdaSpace{}%
\AgdaInductiveConstructor{`ℕ}\<%
\\
%
\>[4]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{Γ}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{⊢}}\AgdaSpace{}%
\AgdaBound{M}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{⦂}}\AgdaSpace{}%
\AgdaBound{A}\<%
\\
%
\>[4]\AgdaSymbol{→}%
\>[1760I]\AgdaBound{Γ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⦂}}\AgdaSpace{}%
\AgdaInductiveConstructor{`ℕ}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{⊢}}\AgdaSpace{}%
\AgdaBound{N}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{⦂}}\AgdaSpace{}%
\AgdaBound{A}\<%
\\
\>[.][@{}l@{}]\<[1760I]%
\>[6]\AgdaComment{-------------------------------------}\<%
\\
%
\>[4]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{Γ}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{⊢}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{case}}\AgdaSpace{}%
\AgdaBound{L}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{[zero⇒}}\AgdaSpace{}%
\AgdaBound{M}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{|suc}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaBound{N}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{]}}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{⦂}}\AgdaSpace{}%
\AgdaBound{A}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaInductiveConstructor{⊢μ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{M}\AgdaSpace{}%
\AgdaBound{A}\AgdaSymbol{\}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaSymbol{→}%
\>[1788I]\AgdaBound{Γ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{,}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⦂}}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{⊢}}\AgdaSpace{}%
\AgdaBound{M}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{⦂}}\AgdaSpace{}%
\AgdaBound{A}\<%
\\
\>[.][@{}l@{}]\<[1788I]%
\>[6]\AgdaComment{-----------------}\<%
\\
%
\>[4]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{Γ}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{⊢}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{μ}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaBound{M}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{⦂}}\AgdaSpace{}%
\AgdaBound{A}\<%
\end{code}
\end{fence}

Each type rule is named after the constructor for the corresponding
term.

Most of the rules have a second name, derived from a convention in
logic, whereby the rule is named after the type connective that it
concerns; rules to introduce and to eliminate each connective are
labeled \texttt{-I} and \texttt{-E}, respectively. As we read the rules
from top to bottom, introduction and elimination rules do what they say
on the tin: the first \emph{introduces} a formula for the connective,
which appears in the conclusion but not in the premises; while the
second \emph{eliminates} a formula for the connective, which appears in
a premise but not in the conclusion. An introduction rule describes how
to construct a value of the type (abstractions yield functions,
successor and zero yield naturals), while an elimination rule describes
how to deconstruct a value of the given type (applications use
functions, case expressions use naturals).

Note also the three places (in \texttt{⊢ƛ}, \texttt{⊢case}, and
\texttt{⊢μ}) where the context is extended with \texttt{x} and an
appropriate type, corresponding to the three places where a bound
variable is introduced.

The rules are deterministic, in that at most one rule applies to every
term.

\hypertarget{Lambda-derivation}{%
\subsection{Example type derivations}\label{Lambda-derivation}}

Type derivations correspond to trees. In informal notation, here is a
type derivation for the Church numeral two,

\begin{myDisplay}
                        ∋s                     ∋z
                        ------------------ ⊢`  -------------- ⊢`
∋s                      Γ₂ ⊢ ` "s" ⦂ A ⇒ A     Γ₂ ⊢ ` "z" ⦂ A
------------------ ⊢`   ------------------------------------- _·_
Γ₂ ⊢ ` "s" ⦂ A ⇒ A      Γ₂ ⊢ ` "s" · ` "z" ⦂ A
---------------------------------------------- _·_
Γ₂ ⊢ ` "s" · (` "s" · ` "z") ⦂ A
-------------------------------------------- ⊢ƛ
Γ₁ ⊢ ƛ "z" ⇒ ` "s" · (` "s" · ` "z") ⦂ A ⇒ A
------------------------------------------------------------- ⊢ƛ
Γ ⊢ ƛ "s" ⇒ ƛ "z" ⇒ ` "s" · (` "s" · ` "z") ⦂ (A ⇒ A) ⇒ A ⇒ A
\end{myDisplay}

where \texttt{∋s} and \texttt{∋z} abbreviate the two derivations,

\begin{myDisplay}
             ---------------- Z
"s" ≢ "z"    Γ₁ ∋ "s" ⦂ A ⇒ A
----------------------------- S       ------------- Z
Γ₂ ∋ "s" ⦂ A ⇒ A                       Γ₂ ∋ "z" ⦂ A
\end{myDisplay}

and where \texttt{Γ₁\ =\ Γ\ ,\ "s"\ ⦂\ A\ ⇒\ A} and
\texttt{Γ₂\ =\ Γ\ ,\ "s"\ ⦂\ A\ ⇒\ A\ ,\ "z"\ ⦂\ A}. The typing
derivation is valid for any \texttt{Γ} and \texttt{A}, for instance, we
might take \texttt{Γ} to be \texttt{∅} and \texttt{A} to be
\texttt{\textasciigrave{}ℕ}.

Here is the above typing derivation formalised in Agda:

\begin{fence}
\begin{code}%
\>[0]\AgdaFunction{Ch}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Type}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Type}\<%
\\
\>[0]\AgdaFunction{Ch}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{A}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaBound{A}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaBound{A}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{⊢twoᶜ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSpace{}%
\AgdaBound{A}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{Γ}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{⊢}}\AgdaSpace{}%
\AgdaFunction{twoᶜ}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{⦂}}\AgdaSpace{}%
\AgdaFunction{Ch}\AgdaSpace{}%
\AgdaBound{A}\<%
\\
\>[0]\AgdaFunction{⊢twoᶜ}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{⊢ƛ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{⊢ƛ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{⊢`}\AgdaSpace{}%
\AgdaFunction{∋s}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{⊢`}\AgdaSpace{}%
\AgdaFunction{∋s}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaInductiveConstructor{⊢`}\AgdaSpace{}%
\AgdaFunction{∋z}\AgdaSymbol{)))}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{where}\<%
\\
%
\>[2]\AgdaFunction{∋s}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{S′}\AgdaSpace{}%
\AgdaInductiveConstructor{Z}\<%
\\
%
\>[2]\AgdaFunction{∋z}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{Z}\<%
\end{code}
\end{fence}

Here are the typings corresponding to computing two plus two:

\begin{fence}
\begin{code}%
\>[0]\AgdaFunction{⊢two}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{Γ}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{⊢}}\AgdaSpace{}%
\AgdaFunction{two}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{⦂}}\AgdaSpace{}%
\AgdaInductiveConstructor{`ℕ}\<%
\\
\>[0]\AgdaFunction{⊢two}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{⊢suc}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{⊢suc}\AgdaSpace{}%
\AgdaInductiveConstructor{⊢zero}\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{⊢plus}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{Γ}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{⊢}}\AgdaSpace{}%
\AgdaFunction{plus}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{⦂}}\AgdaSpace{}%
\AgdaInductiveConstructor{`ℕ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaInductiveConstructor{`ℕ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaInductiveConstructor{`ℕ}\<%
\\
\>[0]\AgdaFunction{⊢plus}\AgdaSpace{}%
\AgdaSymbol{=}%
\>[1872I]\AgdaInductiveConstructor{⊢μ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{⊢ƛ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{⊢ƛ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{⊢case}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{⊢`}\AgdaSpace{}%
\AgdaFunction{∋m}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{⊢`}\AgdaSpace{}%
\AgdaFunction{∋n}\AgdaSymbol{)}\<%
\\
\>[1872I][@{}l@{\AgdaIndent{0}}]%
\>[9]\AgdaSymbol{(}\AgdaInductiveConstructor{⊢suc}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{⊢`}\AgdaSpace{}%
\AgdaFunction{∋+}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaInductiveConstructor{⊢`}\AgdaSpace{}%
\AgdaFunction{∋m′}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaInductiveConstructor{⊢`}\AgdaSpace{}%
\AgdaFunction{∋n′}\AgdaSymbol{)))))}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{where}\<%
\\
%
\>[2]\AgdaFunction{∋+}%
\>[6]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{S′}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{S′}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{S′}\AgdaSpace{}%
\AgdaInductiveConstructor{Z}\AgdaSymbol{))}\<%
\\
%
\>[2]\AgdaFunction{∋m}%
\>[6]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{S′}\AgdaSpace{}%
\AgdaInductiveConstructor{Z}\<%
\\
%
\>[2]\AgdaFunction{∋n}%
\>[6]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{Z}\<%
\\
%
\>[2]\AgdaFunction{∋m′}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{Z}\<%
\\
%
\>[2]\AgdaFunction{∋n′}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{S′}\AgdaSpace{}%
\AgdaInductiveConstructor{Z}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{⊢2+2}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaInductiveConstructor{∅}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{⊢}}\AgdaSpace{}%
\AgdaFunction{plus}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaFunction{two}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaFunction{two}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{⦂}}\AgdaSpace{}%
\AgdaInductiveConstructor{`ℕ}\<%
\\
\>[0]\AgdaFunction{⊢2+2}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{⊢plus}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaFunction{⊢two}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaFunction{⊢two}\<%
\end{code}
\end{fence}

In contrast to our earlier examples, here we have typed \texttt{two} and
\texttt{plus} in an arbitrary context rather than the empty context;
this makes it easy to use them inside other binding contexts as well as
at the top level. Here the two lookup judgments \texttt{∋m} and
\texttt{∋m′} refer to two different bindings of variables named
\texttt{"m"}. In contrast, the two judgments \texttt{∋n} and
\texttt{∋n′} both refer to the same binding of \texttt{"n"} but accessed
in different contexts, the first where \texttt{"n"} is the last binding
in the context, and the second after \texttt{"m"} is bound in the
successor branch of the case.

And here are typings for the remainder of the Church example:

\begin{fence}
\begin{code}%
\>[0]\AgdaFunction{⊢plusᶜ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSpace{}%
\AgdaBound{A}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{Γ}%
\>[22]\AgdaOperator{\AgdaDatatype{⊢}}\AgdaSpace{}%
\AgdaFunction{plusᶜ}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{⦂}}\AgdaSpace{}%
\AgdaFunction{Ch}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaFunction{Ch}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaFunction{Ch}\AgdaSpace{}%
\AgdaBound{A}\<%
\\
\>[0]\AgdaFunction{⊢plusᶜ}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{⊢ƛ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{⊢ƛ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{⊢ƛ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{⊢ƛ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{⊢`}\AgdaSpace{}%
\AgdaFunction{∋m}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaInductiveConstructor{⊢`}\AgdaSpace{}%
\AgdaFunction{∋s}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{⊢`}\AgdaSpace{}%
\AgdaFunction{∋n}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaInductiveConstructor{⊢`}\AgdaSpace{}%
\AgdaFunction{∋s}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaInductiveConstructor{⊢`}\AgdaSpace{}%
\AgdaFunction{∋z}\AgdaSymbol{)))))}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{where}\<%
\\
%
\>[2]\AgdaFunction{∋m}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{S′}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{S′}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{S′}\AgdaSpace{}%
\AgdaInductiveConstructor{Z}\AgdaSymbol{))}\<%
\\
%
\>[2]\AgdaFunction{∋n}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{S′}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{S′}\AgdaSpace{}%
\AgdaInductiveConstructor{Z}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaFunction{∋s}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{S′}\AgdaSpace{}%
\AgdaInductiveConstructor{Z}\<%
\\
%
\>[2]\AgdaFunction{∋z}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{Z}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{⊢sucᶜ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{Γ}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{⊢}}\AgdaSpace{}%
\AgdaFunction{sucᶜ}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{⦂}}\AgdaSpace{}%
\AgdaInductiveConstructor{`ℕ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaInductiveConstructor{`ℕ}\<%
\\
\>[0]\AgdaFunction{⊢sucᶜ}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{⊢ƛ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{⊢suc}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{⊢`}\AgdaSpace{}%
\AgdaFunction{∋n}\AgdaSymbol{))}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{where}\<%
\\
%
\>[2]\AgdaFunction{∋n}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{Z}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{⊢2+2ᶜ}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaInductiveConstructor{∅}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{⊢}}\AgdaSpace{}%
\AgdaFunction{plusᶜ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaFunction{twoᶜ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaFunction{twoᶜ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaFunction{sucᶜ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaInductiveConstructor{`zero}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{⦂}}\AgdaSpace{}%
\AgdaInductiveConstructor{`ℕ}\<%
\\
\>[0]\AgdaFunction{⊢2+2ᶜ}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{⊢plusᶜ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaFunction{⊢twoᶜ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaFunction{⊢twoᶜ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaFunction{⊢sucᶜ}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaInductiveConstructor{⊢zero}\<%
\end{code}
\end{fence}

\hypertarget{interaction-with-agda}{%
\subsection{Interaction with Agda}\label{interaction-with-agda}}

Construction of a type derivation may be done interactively. Start with
the declaration:

\begin{myDisplay}
⊢sucᶜ : ∅ ⊢ sucᶜ ⦂ `ℕ ⇒ `ℕ
⊢sucᶜ = ?
\end{myDisplay}

Typing C-c C-l causes Agda to create a hole and tell us its expected
type:

\begin{myDisplay}
⊢sucᶜ = { }0
?0 : ∅ ⊢ sucᶜ ⦂ `ℕ ⇒ `ℕ
\end{myDisplay}

Now we fill in the hole by typing C-c C-r. Agda observes that the
outermost term in \texttt{sucᶜ} is \texttt{ƛ}, which is typed using
\texttt{⊢ƛ}. The \texttt{⊢ƛ} rule in turn takes one argument, which Agda
leaves as a hole:

\begin{myDisplay}
⊢sucᶜ = ⊢ƛ { }1
?1 : ∅ , "n" ⦂ `ℕ ⊢ `suc ` "n" ⦂ `ℕ
\end{myDisplay}

We can fill in the hole by typing C-c C-r again:

\begin{myDisplay}
⊢sucᶜ = ⊢ƛ (⊢suc { }2)
?2 : ∅ , "n" ⦂ `ℕ ⊢ ` "n" ⦂ `ℕ
\end{myDisplay}

And again:

\begin{myDisplay}
⊢sucᶜ = ⊢ƛ (⊢suc (⊢` { }3))
?3 : ∅ , "n" ⦂ `ℕ ∋ "n" ⦂ `ℕ
\end{myDisplay}

A further attempt with C-c C-r yields the message:

\begin{myDisplay}
Don't know which constructor to introduce of Z or S
\end{myDisplay}

We can fill in \texttt{Z} by hand. If we type C-c C-space, Agda will
confirm we are done:

\begin{myDisplay}
⊢sucᶜ = ⊢ƛ (⊢suc (⊢` Z))
\end{myDisplay}

The entire process can be automated using Agsy, invoked with C-c C-a.

Chapter \protect\hyperlink{Inference}{Inference} will show how to use
Agda to compute type derivations directly.

\hypertarget{lookup-is-injective}{%
\subsection{Lookup is injective}\label{lookup-is-injective}}

The lookup relation \texttt{Γ\ ∋\ x\ ⦂\ A} is injective, in that for
each \texttt{Γ} and \texttt{x} there is at most one \texttt{A} such that
the judgment holds:

\begin{fence}
\begin{code}%
\>[0]\AgdaFunction{∋-injective}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{Γ}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{B}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{Γ}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{∋}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{⦂}}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{Γ}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{∋}}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{⦂}}\AgdaSpace{}%
\AgdaBound{B}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{A}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≡}}\AgdaSpace{}%
\AgdaBound{B}\<%
\\
\>[0]\AgdaFunction{∋-injective}\AgdaSpace{}%
\AgdaInductiveConstructor{Z}%
\>[21]\AgdaInductiveConstructor{Z}%
\>[32]\AgdaSymbol{=}%
\>[35]\AgdaInductiveConstructor{refl}\<%
\\
\>[0]\AgdaFunction{∋-injective}\AgdaSpace{}%
\AgdaInductiveConstructor{Z}%
\>[21]\AgdaSymbol{(}\AgdaInductiveConstructor{S}\AgdaSpace{}%
\AgdaBound{x≢}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}%
\>[32]\AgdaSymbol{=}%
\>[35]\AgdaFunction{⊥-elim}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{x≢}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{∋-injective}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{S}\AgdaSpace{}%
\AgdaBound{x≢}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\AgdaSpace{}%
\AgdaInductiveConstructor{Z}%
\>[32]\AgdaSymbol{=}%
\>[35]\AgdaFunction{⊥-elim}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{x≢}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{∋-injective}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{S}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaBound{∋x}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{S}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaBound{∋x′}\AgdaSymbol{)}%
\>[32]\AgdaSymbol{=}%
\>[35]\AgdaFunction{∋-injective}\AgdaSpace{}%
\AgdaBound{∋x}\AgdaSpace{}%
\AgdaBound{∋x′}\<%
\end{code}
\end{fence}

The typing relation \texttt{Γ\ ⊢\ M\ ⦂\ A} is not injective. For
example, in any \texttt{Γ} the term
\texttt{ƛ\ "x"\ ⇒\ \textasciigrave{}\ "x"} has type \texttt{A\ ⇒\ A} for
any type \texttt{A}.

\hypertarget{non-examples}{%
\subsection{Non-examples}\label{non-examples}}

We can also show that terms are \emph{not} typeable. For example, here
is a formal proof that it is not possible to type the term
\texttt{\textasciigrave{}zero\ ·\ \textasciigrave{}suc\ \textasciigrave{}zero}.
It cannot be typed, because doing so requires that the first term in the
application is both a natural and a function:

\begin{fence}
\begin{code}%
\>[0]\AgdaFunction{nope₁}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{A}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{¬}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{∅}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{⊢}}\AgdaSpace{}%
\AgdaInductiveConstructor{`zero}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`suc}}\AgdaSpace{}%
\AgdaInductiveConstructor{`zero}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{⦂}}\AgdaSpace{}%
\AgdaBound{A}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{nope₁}\AgdaSpace{}%
\AgdaSymbol{(()}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\<%
\end{code}
\end{fence}

As a second example, here is a formal proof that it is not possible to
type
\texttt{ƛ\ "x"\ ⇒\ \textasciigrave{}\ "x"\ ·\ \textasciigrave{}\ "x"}.
It cannot be typed, because doing so requires types \texttt{A} and
\texttt{B} such that \texttt{A\ ⇒\ B\ ≡\ A}:

\begin{fence}
\begin{code}%
\>[0]\AgdaFunction{nope₂}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{A}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{¬}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{∅}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{⊢}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{ƛ}}\AgdaSpace{}%
\AgdaString{"x"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaString{"x"}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{`}}\AgdaSpace{}%
\AgdaString{"x"}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{⦂}}\AgdaSpace{}%
\AgdaBound{A}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{nope₂}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{⊢ƛ}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{⊢`}\AgdaSpace{}%
\AgdaBound{∋x}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{·}}\AgdaSpace{}%
\AgdaInductiveConstructor{⊢`}\AgdaSpace{}%
\AgdaBound{∋x′}\AgdaSymbol{))}%
\>[29]\AgdaSymbol{=}%
\>[32]\AgdaFunction{contradiction}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{∋-injective}\AgdaSpace{}%
\AgdaBound{∋x}\AgdaSpace{}%
\AgdaBound{∋x′}\AgdaSymbol{)}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{where}\<%
\\
%
\>[2]\AgdaFunction{contradiction}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{A}\AgdaSpace{}%
\AgdaBound{B}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{¬}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{A}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{⇒}}\AgdaSpace{}%
\AgdaBound{B}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≡}}\AgdaSpace{}%
\AgdaBound{A}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaFunction{contradiction}\AgdaSpace{}%
\AgdaSymbol{()}\<%
\end{code}
\end{fence}

\hypertarget{quiz-3}{%
\subsubsection{Quiz}\label{quiz-3}}

For each of the following, give a type \texttt{A} for which it is
derivable, or explain why there is no such \texttt{A}.

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  \texttt{∅\ ,\ "y"\ ⦂\ \textasciigrave{}ℕ\ ⇒\ \textasciigrave{}ℕ\ ,\ "x"\ ⦂\ \textasciigrave{}ℕ\ ⊢\ \textasciigrave{}\ "y"\ ·\ \textasciigrave{}\ "x"\ ⦂\ A}
\item
  \texttt{∅\ ,\ "y"\ ⦂\ \textasciigrave{}ℕ\ ⇒\ \textasciigrave{}ℕ\ ,\ "x"\ ⦂\ \textasciigrave{}ℕ\ ⊢\ \textasciigrave{}\ "x"\ ·\ \textasciigrave{}\ "y"\ ⦂\ A}
\item
  \texttt{∅\ ,\ "y"\ ⦂\ \textasciigrave{}ℕ\ ⇒\ \textasciigrave{}ℕ\ ⊢\ ƛ\ "x"\ ⇒\ \textasciigrave{}\ "y"\ ·\ \textasciigrave{}\ "x"\ ⦂\ A}
\end{enumerate}

For each of the following, give types \texttt{A}, \texttt{B}, and
\texttt{C} for which it is derivable, or explain why there are no such
types.

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  \texttt{∅\ ,\ "x"\ ⦂\ A\ ⊢\ \textasciigrave{}\ "x"\ ·\ \textasciigrave{}\ "x"\ ⦂\ B}
\item
  \texttt{∅\ ,\ "x"\ ⦂\ A\ ,\ "y"\ ⦂\ B\ ⊢\ ƛ\ "z"\ ⇒\ \textasciigrave{}\ "x"\ ·\ (\textasciigrave{}\ "y"\ ·\ \textasciigrave{}\ "z")\ ⦂\ C}
\end{enumerate}

\hypertarget{exercise-mul-recommended-1}{%
\subsubsection{\texorpdfstring{Exercise \texttt{⊢mul}
(recommended)}{Exercise ⊢mul (recommended)}}\label{exercise-mul-recommended-1}}

Using the term \texttt{mul} you defined earlier, write out the
derivation showing that it is well typed.

\begin{fence}
\begin{code}%
\>[0]\AgdaComment{-- Your code goes here}\<%
\end{code}
\end{fence}

\hypertarget{exercise-mulux1d9c-practice-1}{%
\subsubsection{\texorpdfstring{Exercise \texttt{⊢mulᶜ}
(practice)}{Exercise ⊢mulᶜ (practice)}}\label{exercise-mulux1d9c-practice-1}}

Using the term \texttt{mulᶜ} you defined earlier, write out the
derivation showing that it is well typed.

\begin{fence}
\begin{code}%
\>[0]\AgdaComment{-- Your code goes here}\<%
\end{code}
\end{fence}

\hypertarget{unicode}{%
\section{Unicode}\label{unicode}}

This chapter uses the following unicode:

\begin{myDisplay}
⇒  U+21D2  RIGHTWARDS DOUBLE ARROW (\=>)
ƛ  U+019B  LATIN SMALL LETTER LAMBDA WITH STROKE (\Gl-)
·  U+00B7  MIDDLE DOT (\cdot)
≟  U+225F  QUESTIONED EQUAL TO (\?=)
—  U+2014  EM DASH (\em)
↠  U+21A0  RIGHTWARDS TWO HEADED ARROW (\rr-)
ξ  U+03BE  GREEK SMALL LETTER XI (\Gx or \xi)
β  U+03B2  GREEK SMALL LETTER BETA (\Gb or \beta)
Γ  U+0393  GREEK CAPITAL LETTER GAMMA (\GG or \Gamma)
≠  U+2260  NOT EQUAL TO (\=n or \ne)
∋  U+220B  CONTAINS AS MEMBER (\ni)
∅  U+2205  EMPTY SET (\0)
⊢  U+22A2  RIGHT TACK (\vdash or \|-)
⦂  U+2982  Z NOTATION TYPE COLON (\:)
😇  U+1F607  SMILING FACE WITH HALO
😈  U+1F608  SMILING FACE WITH HORNS
\end{myDisplay}

We compose reduction \texttt{—→} from an em dash \texttt{—} and an arrow
\texttt{→}. Similarly for reflexive and transitive closure \texttt{—↠}.

